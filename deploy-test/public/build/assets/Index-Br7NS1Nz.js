import{r as n,z as O,s as K,c as R,o as p,w as U,a as e,i as E,d as c,e as _,h as m,t as l,f as Y,v as P,F as W,j as z,y as x,W as M}from"./app-BikmxpuD.js";import{D as q}from"./DashboardLayout-BlsjsCh-.js";import H from"./ImportExportModal-BjZTkJ0a.js";import J from"./GroupModal-5GCJ_RPH.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SidebarLink-BlIqNOVv.js";const X={class:"flex justify-between items-center mb-6"},Z={class:"text-2xl font-bold"},ee={class:"text-gray-400 text-base font-normal"},te={class:"flex gap-2 items-center"},se=["disabled"],ae=["disabled"],oe={class:"flex flex-col md:flex-row gap-4 mb-4"},re={class:"bg-gray-50 border rounded p-4 w-full md:w-1/4"},le={class:"flex-1 overflow-x-auto"},ne={class:"min-w-full divide-y divide-gray-200 bg-white rounded-lg border"},ie={class:"bg-white divide-y divide-gray-200"},de={class:"px-6 py-4 whitespace-nowrap"},ue=["onClick"],pe={class:"px-6 py-4 whitespace-nowrap"},ce={class:"px-6 py-4 whitespace-nowrap"},me=["onClick"],xe={class:"px-6 py-4 whitespace-nowrap"},fe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"px-6 py-4 whitespace-nowrap"},ve={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex items-center gap-2"},be=["onClick"],he=["onClick","disabled"],_e={key:0},we={key:0,class:"p-4 text-center text-gray-500"},ke={key:1,class:"p-4 text-center text-red-500"},Ce={key:2,class:"p-4 text-center text-green-500"},Ae={__name:"Index",props:{members:{type:Array,default:()=>[]}},setup(L){const N=L,g=n(""),w=n([]),i=n(!1),v=n(!1),d=n(""),u=n(""),y=n(!1),b=n(!1),k=n(null),f=n(null),C=O(()=>{let s=w.value;if(g.value){const t=g.value.toLowerCase();s=s.filter(a=>(a.name||"").toLowerCase().includes(t)||(a.member_id||"").toLowerCase().includes(t))}return s}),$=()=>{M.visit("/dashboard/members/create")},I=async()=>{try{i.value=!0,await M.visit("/dashboard/members/groups",{preserveState:!0})}catch(s){console.error("Failed to navigate to groups:",s),d.value="Failed to load groups page. Please try again."}finally{i.value=!1}};function S(){y.value=!0}function F(s=null){f.value=s,k.value=s?{id:null,name:Array.isArray(s.groups)?s.groups.join(", "):""}:null,b.value=!0}async function G(s){var t,a;try{if(f.value){const o=s.name?s.name.split(",").map(r=>r.trim()).filter(r=>r):[];await x.put(`/dashboard/members/${f.value.id}`,{groups:o}),u.value="Member groups updated!"}else await x.post("/dashboard/members/groups",{name:s.name}),u.value="Group saved!";b.value=!1,f.value=null,k.value=null,h()}catch(o){d.value=((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to save groups."}}async function T(s){var a,o;const t=new FormData;t.append("file",s);try{const r=await x.post("/dashboard/members/import",t,{headers:{"Content-Type":"multipart/form-data"}});u.value=r.data.message,y.value=!1,h()}catch(r){d.value=((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to import members."}}function j(){y.value=!1}async function B(){var s,t;try{v.value=!0;const a=await x.get("/dashboard/members/export",{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=o,r.setAttribute("download","participants.xlsx"),document.body.appendChild(r),r.click(),document.body.removeChild(r),u.value="Export successful!"}catch(a){d.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to export members."}finally{v.value=!1}}async function h(){var s,t;i.value=!0,d.value="",u.value="";try{const a=await x.get("/dashboard/members");w.value=a.data.map(o=>({id:o.id,name:`${o.first_name||""} ${o.last_name||""}`.trim()||"N/A",member_id:o.member_id||"N/A",groups:Array.isArray(o.member_groups)?o.member_groups.map(r=>r.name):[],public_registration:!!o.public_registration,email_status:o.email_status||"OK",archived:!!o.archived,added:o.created_at?new Date(o.created_at).toLocaleDateString()+" "+new Date(o.created_at).toLocaleTimeString().slice(0,5):"N/A"}))}catch(a){d.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load members."}finally{i.value=!1}}async function V(s){var t,a,o,r;if(confirm(`Are you sure you want to delete ${s.name||"this member"}?`))try{i.value=!0,await x.delete(`/dashboard/members/${s.id}`),u.value="Member deleted successfully!",await h()}catch(A){d.value=((t=A.response)==null?void 0:t.status)===404?"Member not found.":((a=A.response)==null?void 0:a.status)===403?"You do not have permission to delete this member.":((r=(o=A.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to delete member."}finally{i.value=!1}}function D(s){M.visit(`/dashboard/members/${s.id}/edit`)}return K(()=>{N.members.length>0?w.value=N.members.map(s=>({id:s.id,name:`${s.first_name||""} ${s.last_name||""}`.trim()||"N/A",member_id:s.member_id||"N/A",groups:Array.isArray(s.member_groups)?s.member_groups.map(t=>t.name):[],public_registration:!!s.public_registration,email_status:s.email_status||"OK",archived:!!s.archived,added:s.created_at?new Date(s.created_at).toLocaleDateString()+" "+new Date(s.created_at).toLocaleTimeString().slice(0,5):"N/A"})):h()}),(s,t)=>(p(),R(q,null,{default:U(()=>[e("div",null,[e("div",X,[e("h1",Z,[t[2]||(t[2]=m("Members ")),e("span",ee,l(C.value.length)+" entries",1)]),e("div",te,[e("button",{onClick:I,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded flex items-center",disabled:i.value},t[3]||(t[3]=[e("i",{class:"fas fa-users mr-2"},null,-1),m(" Member groups ")]),8,se),e("button",{onClick:B,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded flex items-center",disabled:v.value},[t[4]||(t[4]=e("i",{class:"fas fa-file-export mr-2"},null,-1)),m(" "+l(v.value?"Exporting...":"Export"),1)],8,ae),e("button",{onClick:S,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded flex items-center"},t[5]||(t[5]=[e("i",{class:"fas fa-file-import mr-2"},null,-1),m(" Import ")])),t[7]||(t[7]=e("button",{class:"rounded-full bg-gray-100 p-2 hover:bg-gray-200"},[e("i",{class:"fas fa-filter text-gray-500"})],-1)),e("button",{onClick:$,class:"rounded-full bg-yellow-400 hover:bg-yellow-500 text-white text-2xl flex items-center justify-center w-10 h-10"},t[6]||(t[6]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),e("div",oe,[e("div",re,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium mb-1"},"Search",-1)),Y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),type:"text",class:"input w-full mb-2",placeholder:"Search"},null,512),[[P,g.value]])]),e("div",le,[e("table",ne,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Member ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Groups"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Public Registration"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Archived"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Added"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",ie,[(p(!0),c(W,null,z(C.value,a=>(p(),c("tr",{key:a.id},[e("td",de,[e("button",{onClick:o=>D(a),class:"text-indigo-600 hover:text-indigo-900 font-medium"},l(a.name),9,ue)]),e("td",pe,l(a.member_id||"N/A"),1),e("td",ce,[e("button",{onClick:o=>F(a),class:"text-indigo-600 hover:text-indigo-900"},l(a.groups.join(", ")||"None"),9,me)]),e("td",xe,l(a.public_registration?"Yes":"No"),1),e("td",fe,l(a.email_status||"OK"),1),e("td",ge,l(a.archived?"Yes":"No"),1),e("td",ve,l(a.added||"N/A"),1),e("td",ye,[e("button",{onClick:o=>D(a),class:"text-indigo-600 hover:text-indigo-900 flex items-center gap-1"},t[9]||(t[9]=[e("i",{class:"fas fa-edit"},null,-1),m(" Edit ")]),8,be),e("button",{onClick:o=>V(a),class:"text-red-600 hover:text-red-900 flex items-center gap-1",disabled:i.value},t[10]||(t[10]=[e("i",{class:"fas fa-trash"},null,-1),m(" Delete ")]),8,he)])]))),128)),C.value.length===0?(p(),c("tr",_e,t[11]||(t[11]=[e("td",{colspan:"8",class:"px-6 py-4 text-center text-gray-400"},"No entries found ðŸ¥º",-1)]))):_("",!0)])])])]),E(H,{show:y.value,onClose:j,onImport:T},null,8,["show"]),E(J,{show:b.value,group:k.value,member:f.value,onSave:G,onClose:t[1]||(t[1]=()=>b.value=!1)},null,8,["show","group","member"]),i.value?(p(),c("div",we,"Loading...")):_("",!0),d.value?(p(),c("div",ke,l(d.value),1)):_("",!0),u.value?(p(),c("div",Ce,l(u.value),1)):_("",!0)])]),_:1}))}},Ie=Q(Ae,[["__scopeId","data-v-9692ebac"]]);export{Ie as default};
