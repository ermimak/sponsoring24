import{p as T,r as m,z as O,s as N,A as S,d as c,o as d,a as t,e as g,b as M,f as u,q as L,v,h as R,t as i,g as U,F as q,j as z,y as C,B as w,k as P,c as G,w as J,u as D,S as W,W as $}from"./app-BikmxpuD.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"bg-white shadow rounded-lg p-6 mb-6"},Q={class:"bg-white shadow rounded-lg p-6"},X={class:"flex justify-between items-center mb-4"},Y={class:"text-xl font-semibold"},Z={class:"text-gray-500"},ee={class:"space-x-2"},te=["disabled"],se=["disabled"],le={class:"min-w-full divide-y divide-gray-200 bg-white rounded-lg border mb-4"},ae={class:"bg-gray-50"},oe={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ne={class:"px-6 py-4 whitespace-nowrap"},ie=["value"],ue={class:"px-6 py-4 whitespace-nowrap"},re={class:"px-6 py-4 whitespace-nowrap"},de={class:"px-6 py-4 whitespace-nowrap"},pe={class:"px-6 py-4 whitespace-nowrap"},me={class:"px-6 py-4 whitespace-nowrap"},ce={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},xe={key:0},ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},fe={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto"},ge={class:"mb-4"},be={class:"mb-4"},ye={key:1,class:"fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg"},we={key:2,class:"fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg"},he={__name:"DonationsTab",props:{project:Object,filters:Object,donations:Array},setup(F){const n=F,_=T(),x=m([]),a=m({status:n.filters.status||"",date_from:n.filters.date_from||"",date_to:n.filters.date_to||"",amount_min:n.filters.amount_min||"",amount_max:n.filters.amount_max||""}),o=m([]),p=m(!1),h=m(!1),r=m({subject:"",message:""}),b=m(!1),y=O(()=>{var l,e;return{success:((l=_.props.flash)==null?void 0:l.success)||"",error:((e=_.props.flash)==null?void 0:e.error)||""}}),f=((l,e)=>{let s;return(...k)=>{clearTimeout(s),s=setTimeout(()=>l(...k),e)}})(async()=>{try{const l=await C.get(w("dashboard.project.donations.fetch",n.project.id),{params:{status:a.value.status,date_from:a.value.date_from,date_to:a.value.date_to,amount_min:a.value.amount_min,amount_max:a.value.amount_max}});x.value=l.data.data||l.data,o.value=[],p.value=!1}catch(l){console.error("Failed to fetch donations:",l),x.value=[],o.value=[],p.value=!1}},300);function V(){p.value?o.value=x.value.map(l=>l.id):o.value=[]}function A(){f()}function E(){h.value=!0}function j(){h.value=!1,r.value.subject="",r.value.message=""}function I(){$.post(w("project.donations.massEmail",n.project.id),{donation_ids:o.value,subject:r.value.subject,message:r.value.message},{onSuccess:()=>{j(),o.value=[],p.value=!1,f()},onError:l=>{console.error("Failed to send mass email:",l),alert("Failed to send mass email.")}})}async function B(){if(o.value.length!==0){b.value=!0;try{const l=await C.post(w("project.donations.bulkInvoice",n.project.id),{donation_ids:o.value},{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([l.data],{type:"application/pdf"})),s=document.createElement("a");s.href=e,s.setAttribute("download",`bulk_invoice_${n.project.id}_${new Date().toISOString().slice(0,10)}.pdf`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e),o.value=[],p.value=!1,alert("Bulk invoice generated successfully!")}catch(l){console.error("Failed to generate bulk invoice:",l),alert("Failed to generate bulk invoice. Please try again.")}finally{b.value=!1}}}return N(()=>{f()}),S(()=>n.project.id,l=>{l&&f()}),S(a,(l,e)=>{JSON.stringify(l)!==JSON.stringify(e)&&f()},{deep:!0}),(l,e)=>(d(),c("div",null,[t("div",K,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Filters",-1)),t("form",{onSubmit:M(A,["prevent"]),class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.status=s),class:"input w-full"},e[9]||(e[9]=[t("option",{value:""},"All",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"completed"},"Completed",-1)]),512),[[L,a.value.status]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date From",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.date_from=s),type:"date",class:"input w-full"},null,512),[[v,a.value.date_from]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date To",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.date_to=s),type:"date",class:"input w-full"},null,512),[[v,a.value.date_to]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Amount Min",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.amount_min=s),type:"number",step:"0.01",class:"input w-full"},null,512),[[v,a.value.amount_min]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Amount Max",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.amount_max=s),type:"number",step:"0.01",class:"input w-full"},null,512),[[v,a.value.amount_max]])]),e[15]||(e[15]=t("div",{class:"flex items-end"},[t("button",{type:"submit",class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"},"Apply Filters")],-1))],32)]),t("div",Q,[t("div",X,[t("h2",Y,[e[17]||(e[17]=R(" Donations ")),t("span",Z,"("+i(x.value.length)+" entries)",1)]),t("div",ee,[t("button",{onClick:E,disabled:o.value.length===0,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"}," Mass Email ",8,te),t("button",{onClick:B,disabled:o.value.length===0||b.value,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"},i(b.value?"Generating...":"Bulk Invoice"),9,se)])]),t("table",le,[t("thead",ae,[t("tr",null,[t("th",oe,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>p.value=s),onChange:V},null,544),[[U,p.value]])]),e[18]||(e[18]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Donor",-1)),e[19]||(e[19]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Participant",-1)),e[20]||(e[20]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Amount",-1)),e[21]||(e[21]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date",-1)),e[22]||(e[22]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status",-1)),e[23]||(e[23]=t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions",-1))])]),t("tbody",null,[(d(!0),c(q,null,z(x.value,s=>(d(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",ne,[u(t("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[6]||(e[6]=k=>o.value=k)},null,8,ie),[[U,o.value]])]),t("td",ue,i(s.donor_name),1),t("td",re,i(s.participant_name),1),t("td",de,i(s.amount)+" "+i(s.currency),1),t("td",pe,i(s.date),1),t("td",me,[t("span",{class:P([{"bg-green-100 text-green-800":s.status==="completed","bg-yellow-100 text-yellow-800":s.status==="pending"},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},i(s.status),3)]),t("td",ce,[s.participant_id?(d(),G(D(W),{key:0,href:D(w)("participant.donate.payment",{projectId:n.project.id,participantId:s.participant_id,donationId:s.id}),class:"text-purple-600 hover:text-purple-900",title:"To the invoice page"},{default:J(()=>e[24]||(e[24]=[t("i",{class:"fas fa-file-invoice-dollar"},null,-1)])),_:2},1032,["href"])):g("",!0)])]))),128)),x.value.length===0?(d(),c("tr",xe,e[25]||(e[25]=[t("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-400"},"No donations found ðŸ˜Š",-1)]))):g("",!0)])])]),h.value?(d(),c("div",ve,[t("div",fe,[e[29]||(e[29]=t("h2",{class:"text-xl font-bold mb-4"},"Send Mass Email",-1)),t("form",{onSubmit:M(I,["prevent"])},[t("div",ge,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Subject",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>r.value.subject=s),type:"text",class:"input w-full",required:""},null,512),[[v,r.value.subject]])]),t("div",be,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Message",-1)),u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>r.value.message=s),class:"input w-full",rows:"4",required:""},null,512),[[v,r.value.message]])]),t("div",{class:"flex justify-end space-x-4"},[t("button",{onClick:j,type:"button",class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),e[28]||(e[28]=t("button",{type:"submit",class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"},"Send",-1))])],32)])])):g("",!0),y.value.success?(d(),c("div",ye,i(y.value.success),1)):g("",!0),y.value.error?(d(),c("div",we,i(y.value.error),1)):g("",!0)]))}},Se=H(he,[["__scopeId","data-v-dcf0c5fd"]]);export{Se as default};
