import{p as L,r as f,s as T,d as S,o as x,a as o,e as R,t as b,k as w,h as y,b as B,W as V}from"./app-BikmxpuD.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";var j="basil",N=function(e){return e===3?"v3":e},P="https://js.stripe.com",O="".concat(P,"/").concat(j,"/stripe.js"),U=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,W=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var A=function(e){return U.test(e)||W.test(e)},$=function(){for(var e=document.querySelectorAll('script[src^="'.concat(P,'"]')),t=0;t<e.length;t++){var i=e[t];if(A(i.src))return i}return null},E=function(e){var t="",i=document.createElement("script");i.src="".concat(O).concat(t);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(i),i},G=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.3.0",startTime:t})},u=null,g=null,h=null,J=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},M=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},z=function(e){return u!==null?u:(u=new Promise(function(t,i){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var n=$();if(!(n&&e)){if(!n)n=E(e);else if(n&&h!==null&&g!==null){var s;n.removeEventListener("load",h),n.removeEventListener("error",g),(s=n.parentNode)===null||s===void 0||s.removeChild(n),n=E(e)}}h=M(t,i),g=J(i),n.addEventListener("load",h),n.addEventListener("error",g)}catch(d){i(d);return}}),u.catch(function(t){return u=null,Promise.reject(t)}))},D=function(e,t,i){if(e===null)return null;var n=t[0],s=n.match(/^pk_test/),d=N(e.version),m=j;s&&d!==m&&console.warn("Stripe.js@".concat(d," was loaded on the page, but @stripe/stripe-js@").concat("7.3.0"," expected Stripe.js@").concat(m,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var v=e.apply(void 0,t);return G(v,i),v},p,C=!1,k=function(){return p||(p=z(null).catch(function(e){return p=null,Promise.reject(e)}),p)};Promise.resolve().then(function(){return k()}).catch(function(a){C||console.warn(a)});var q=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];C=!0;var n=Date.now();return k().then(function(s){return D(s,t,n)})};const X={class:"min-h-screen bg-gray-50 flex flex-col items-center justify-center"},F={class:"bg-white shadow-lg rounded-lg p-8 w-full max-w-md mt-10"},K={class:"text-3xl font-bold text-center mb-6"},H={class:"space-y-4 mb-8"},Q={key:0,class:"mt-6"},Y=["disabled"],Z={__name:"DonationPayment",props:{project:Object,participant:Object,donation:Object},setup(a){const e=a;L();const t=f(null),i=f(!1),n=f(null),s=f(null);T(async()=>{n.value=await q(void 0);const c=n.value.elements();s.value=c.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),s.value.mount("#card-element"),s.value.on("change",r=>{const l=document.getElementById("card-errors");r.error?l.textContent=r.error.message:l.textContent=""})});function d(c){t.value=c}async function m(){if(!n.value||!s.value){console.error("Stripe not initialized");return}i.value=!0;try{const c=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e.donation.amount,currency:e.donation.currency.toLowerCase(),donation_id:e.donation.id})}),{clientSecret:r}=await c.json(),l=await n.value.confirmCardPayment(r,{payment_method:{card:s.value,billing_details:{email:e.donation.supporter_email}}});if(l.error){const I=document.getElementById("card-errors");I.textContent=l.error.message}else l.paymentIntent.status==="succeeded"&&V.visit(route("participant.donate.success",{projectId:e.project.id,participantId:e.participant.id,donationId:e.donation.id}))}catch(c){console.error("Payment failed:",c);const r=document.getElementById("card-errors");r.textContent="An error occurred while processing your payment. Please try again."}finally{i.value=!1}}function v(){window.history.back()}return(c,r)=>(x(),S("div",X,[o("div",F,[o("h1",K," Pay "+b(a.donation.amount)+" "+b(a.donation.currency)+" now via ",1),o("div",H,[o("button",{onClick:r[0]||(r[0]=l=>d("invoice")),class:w([{"bg-purple-50 border-purple-500":t.value==="invoice"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[3]||(r[3]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2","stroke-width":"2"})])],-1),y(" The invoice ")]),2),o("button",{onClick:r[1]||(r[1]=l=>d("twint")),class:w([{"bg-purple-50 border-purple-500":t.value==="twint"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[4]||(r[4]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"})])],-1),y(" TWINT ")]),2),o("button",{onClick:r[2]||(r[2]=l=>d("card")),class:w([{"bg-purple-50 border-purple-500":t.value==="card"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[5]||(r[5]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2","stroke-width":"2"}),o("rect",{x:"6",y:"10",width:"4",height:"4","stroke-width":"2"})])],-1),y(" Credit or debit card ")]),2)]),t.value==="card"?(x(),S("div",Q,[o("form",{id:"payment-form",onSubmit:B(m,["prevent"])},[r[6]||(r[6]=o("div",{id:"card-element",class:"p-3 border rounded-lg mb-4"},null,-1)),r[7]||(r[7]=o("div",{id:"card-errors",class:"text-red-500 text-sm mb-4",role:"alert"},null,-1)),o("button",{type:"submit",disabled:i.value,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},b(i.value?"Processing...":`Pay ${a.donation.amount} ${a.donation.currency}`),9,Y)],32)])):R("",!0),o("div",{class:"flex justify-center mt-6"},[o("button",{onClick:v,class:"border border-red-500 text-red-600 px-6 py-2 rounded-lg flex items-center hover:bg-red-50 transition"},r[8]||(r[8]=[o("span",{class:"mr-2"},"‚Üê",-1),y(" Back ")]))])])]))}},re=_(Z,[["__scopeId","data-v-6d30a1e1"]]);export{re as default};
