import{p as W,r as p,z as G,s as O,A as J,d as l,o as i,a as t,e as v,t as n,h as C,f as b,v as g,g as K,F as S,j as E,b as F,q as U,y as f,W as $,i as Q,w as X,u as Y,S as Z}from"./app-BikmxpuD.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"flex justify-between items-center mb-4"},se={class:"text-xl font-semibold"},oe={class:"flex flex-col md:flex-row gap-4 mb-4"},ae={class:"bg-gray-50 border rounded p-4 w-full md:w-1/3"},le={class:"flex items-center"},ie={class:"flex-1 overflow-x-auto"},ne={class:"min-w-full divide-y divide-gray-200 bg-white rounded-lg border"},re={class:"bg-white divide-y divide-gray-200"},de={class:"px-6 py-4 whitespace-nowrap"},ue={class:"text-sm text-gray-500"},pe={key:0,class:"text-green-600 text-xs"},ce={class:"px-6 py-4 whitespace-nowrap"},me={class:"px-6 py-4 whitespace-nowrap"},ve={class:"px-6 py-4 whitespace-nowrap"},be={class:"px-6 py-4 whitespace-nowrap flex space-x-2"},xe=["onClick"],ge=["onClick"],fe=["onClick"],ye={key:0},we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},he={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg"},ke={class:"mb-4"},je=["value"],_e={class:"mb-4"},Ce={class:"mb-4"},Me={class:"flex gap-2 justify-end"},Se=["disabled"],Ee={key:0,class:"text-gray-500 mt-2"},$e={key:1,class:"text-red-600 mt-2"},Ie={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Pe={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg"},Ve={class:"text-xl font-bold mb-4"},Fe={class:"mb-4"},Ue=["value"],ze={class:"mb-4"},Be={class:"mb-4"},Le={class:"flex gap-2 justify-end"},Ne=["disabled"],qe={key:0,class:"text-gray-500 mt-2"},Ae={key:1,class:"text-red-600 mt-2"},De={__name:"ParticipantsTab",props:{projectId:String},setup(z){W();const r=z,y=p([]),w=p(""),M=p(!1),x=p([]),h=p(!1),k=p(!1),j=p(null),c=p({template_id:"",subject:"",body:""}),m=p({template_id:"",subject:"",body:""}),u=p(!1),d=p("");async function I(){var o,e;u.value=!0,d.value="";try{console.log("Fetching participants for project:",r.projectId);const{data:a}=await f.get(`/dashboard/projects/${r.projectId}/participants`);y.value=a.data||[],console.log("Participants fetched:",y.value)}catch(a){console.error("Fetch error:",a.response?a.response.data:a),d.value="Failed to load participants: "+(((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.error)||a.message)}finally{u.value=!1}}async function B(){var o,e;try{const{data:a}=await f.get("/dashboard/email-templates",{params:{project_id:r.projectId}});x.value=a.data}catch(a){d.value="Failed to load email templates: "+(((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.error)||a.message)}}function L(){console.log("Navigating to:",`/dashboard/projects/${r.projectId}/participants/create`),r.projectId?$.visit(`/dashboard/projects/${r.projectId}/participants/create`,{onError:o=>{console.error("Navigation failed:",o),alert("Failed to navigate to add page. Check console for details.")},onSuccess:()=>{console.log("Navigation successful")}}):(console.error("projectId is undefined"),alert("Project ID is missing. Please reload the page."))}function N(o){$.visit(`/projects/${r.projectId}/participants/${o.id}`)}function q(o){$.visit(`/projects/${r.projectId}/participants/${o.id}/donate`)}function A(o){j.value=o;const e=x.value.find(a=>a.type==="participant_invitation")||x.value[0];c.value={template_id:(e==null?void 0:e.id)||"",subject:(e==null?void 0:e.subject)||"",body:(e==null?void 0:e.body)||""},h.value=!0}function D(){const o=x.value.find(e=>e.type==="mass_participant")||x.value[0];m.value={template_id:(o==null?void 0:o.id)||"",subject:(o==null?void 0:o.subject)||"",body:(o==null?void 0:o.body)||""},k.value=!0}async function H(){var o,e;u.value=!0,d.value="";try{await f.post(`/dashboard/participants/${j.value.id}/send-email`,{...c.value,project_id:r.projectId}),h.value=!1}catch(a){d.value="Failed to send email: "+(((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.error)||a.message)}finally{u.value=!1}}async function R(){var o,e;u.value=!0,d.value="";try{await f.post(`/dashboard/projects/${r.projectId}/send-mass-email`,{...m.value}),k.value=!1}catch(a){d.value="Failed to send mass email: "+(((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.error)||a.message)}finally{u.value=!1}}async function T(){var o,e;u.value=!0,d.value="";try{const{data:a}=await f.get(`/dashboard/projects/${r.projectId}/participants/export`,{responseType:"blob"}),_=window.URL.createObjectURL(new Blob([a])),s=document.createElement("a");s.href=_,s.setAttribute("download",`participants_${r.projectId}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(a){d.value="Failed to export participants: "+(((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.error)||a.message)}finally{u.value=!1}}const P=G(()=>{let o=y.value;if(w.value){const e=w.value.toLowerCase();o=o.filter(a=>`${a.first_name} ${a.last_name}`.toLowerCase().includes(e)||a.email.toLowerCase().includes(e))}return M.value||(o=o.filter(e=>e.member_groups.length>0)),o});return O(()=>{I(),B()}),J(()=>r.projectId,()=>{I()}),(o,e)=>{var a,_;return i(),l("div",null,[t("div",te,[t("h2",se,"Participants "+n(y.value.length)+" entries",1),t("div",{class:"flex space-x-2"},[t("button",{onClick:D,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded flex items-center",title:"Mass Email"},e[10]||(e[10]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9-6 9 6v12a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9 6 9-6"})],-1),C(" Mass email ")])),t("button",{onClick:T,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded flex items-center",title:"Export"},e[11]||(e[11]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),C(" Export ")])),t("button",{onClick:L,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"}," Add ")])]),e[29]||(e[29]=t("p",{class:"text-gray-600 mb-4"}," Members must be participants in a project to be able to collect donations. They can be added to the project individually or in groups. ",-1)),t("div",oe,[t("div",ae,[e[13]||(e[13]=t("h3",{class:"font-semibold mb-2"},"Filter",-1)),e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"Search",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),type:"text",class:"input w-full mb-2",placeholder:"Search"},null,512),[[g,w.value]]),t("label",le,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>M.value=s),class:"mr-2"},null,512),[[K,M.value]]),e[12]||(e[12]=C(" All groups "))])]),t("div",ie,[t("table",ne,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Participant"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Supporters"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sales volume"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Emails"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",re,[(i(!0),l(S,null,E(P.value,s=>(i(),l("tr",{key:s.id},[t("td",de,[Q(Y(Z),{href:`/dashboard/members/${s.id}/edit`,class:"text-indigo-600 hover:text-indigo-900"},{default:X(()=>[C(n(s.first_name)+" "+n(s.last_name),1)]),_:2},1032,["href"]),t("p",ue,n(s.email),1),s.landing_page_opened?(i(),l("span",pe,"Landing page opened")):v("",!0)]),t("td",ce,n(s.supporters),1),t("td",me,n(s.sales_volume),1),t("td",ve,n(s.emails),1),t("td",be,[t("button",{onClick:V=>N(s),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"To the participant landing page"},e[15]||(e[15]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,xe),t("button",{onClick:V=>q(s),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"Public Donation Page"},e[16]||(e[16]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 1.343-3 3v2h6v-2c0-1.657-1.343-3-3-3zm0-4a7 7 0 00-7 7v2h2v-2a5 5 0 0110 0v2h2v-2a7 7 0 00-7-7z"})],-1)]),8,ge),t("button",{onClick:V=>A(s),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"Send Email"},e[17]||(e[17]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9-6 9 6v12a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9 6 9-6"})],-1)]),8,fe)])]))),128)),P.value.length===0?(i(),l("tr",ye,e[18]||(e[18]=[t("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-400"},"No entries found ðŸ¥º",-1)]))):v("",!0)])])])]),k.value?(i(),l("div",we,[t("div",he,[e[24]||(e[24]=t("h2",{class:"text-xl font-bold mb-4"},"Send Mass Email",-1)),t("form",{onSubmit:F(R,["prevent"])},[t("div",ke,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium mb-1"},"Select Email Template",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>m.value.template_id=s),class:"input w-full",required:""},[e[20]||(e[20]=t("option",{value:"",disabled:""},"Select a template",-1)),(i(!0),l(S,null,E(x.value,s=>(i(),l("option",{key:s.id,value:s.id},n(s.name)+" ("+n(s.type)+") ",9,je))),128))],512),[[U,m.value.template_id]])]),t("div",_e,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-1"},"Subject",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>m.value.subject=s),type:"text",class:"input w-full",required:""},null,512),[[g,m.value.subject]])]),t("div",Ce,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),b(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>m.value.body=s),class:"input w-full",rows:"5",required:""},null,512),[[g,m.value.body]])]),t("div",Me,[t("button",{type:"button",onClick:e[5]||(e[5]=s=>k.value=!1),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",class:"bg-purple-600 text-white px-4 py-2 rounded",disabled:u.value},"Send",8,Se)])],32),u.value?(i(),l("div",Ee,"Sending...")):v("",!0),d.value?(i(),l("div",$e,n(d.value),1)):v("",!0)])])):v("",!0),h.value?(i(),l("div",Ie,[t("div",Pe,[t("h2",Ve,"Send Email to "+n((a=j.value)==null?void 0:a.first_name)+" "+n((_=j.value)==null?void 0:_.last_name),1),t("form",{onSubmit:F(H,["prevent"])},[t("div",Fe,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-1"},"Select Email Template",-1)),b(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>c.value.template_id=s),class:"input w-full",required:""},[e[25]||(e[25]=t("option",{value:"",disabled:""},"Select a template",-1)),(i(!0),l(S,null,E(x.value,s=>(i(),l("option",{key:s.id,value:s.id},n(s.name)+" ("+n(s.type)+") ",9,Ue))),128))],512),[[U,c.value.template_id]])]),t("div",ze,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-1"},"Subject",-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>c.value.subject=s),type:"text",class:"input w-full",required:""},null,512),[[g,c.value.subject]])]),t("div",Be,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),b(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>c.value.body=s),class:"input w-full",rows:"5",required:""},null,512),[[g,c.value.body]])]),t("div",Le,[t("button",{type:"button",onClick:e[9]||(e[9]=s=>h.value=!1),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",class:"bg-purple-600 text-white px-4 py-2 rounded",disabled:u.value},"Send",8,Ne)])],32),u.value?(i(),l("div",qe,"Sending...")):v("",!0),d.value?(i(),l("div",Ae,n(d.value),1)):v("",!0)])])):v("",!0)])}}},Te=ee(De,[["__scopeId","data-v-ca0aae7c"]]);export{Te as default};
