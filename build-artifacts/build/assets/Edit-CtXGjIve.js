import{r as _,p as P,z as C,s as F,A,c as b,o as s,w as E,a,d as r,t as f,F as T,j as L,k as M,e as p,b as N,f as i,v as d,q as O,g as x,i as B,B as R,y as H}from"./app-BikmxpuD.js";import{D as $}from"./DashboardLayout-BlsjsCh-.js";import z from"./AnalyticsTab-Ct--xcXz.js";import J from"./EmailsTab-DociStSx.js";import h from"./DonationsTab-C3RH0bQQ.js";import G from"./ProjectImageUpload-C6pkjyBI.js";import K from"./ParticipantsTab-B2HzPv2j.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SidebarLink-BlIqNOVv.js";const W={class:"max-w-5xl mx-auto py-8"},X={class:"text-2xl font-bold mb-6"},Y={class:"flex border-b mb-8"},Z=["onClick"],ee={key:0,class:"text-center text-gray-500"},te={key:1,class:"text-center text-red-500"},ae={key:2},le={key:0},ne={class:"bg-gray-50 rounded-lg p-6 border"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"mt-6"},ie={class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6"},re={key:0,class:"mt-2"},ue=["src"],de={key:0,class:"mt-2"},pe=["src"],me={class:"bg-gray-50 rounded-lg p-6 border"},ce={class:"flex items-center mb-2"},ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2"},_e={class:"bg-gray-50 rounded-lg p-6 border"},be={class:"flex items-center mb-2"},fe={class:"bg-gray-50 rounded-lg p-6 border"},ge={class:"flex items-center mb-2"},xe={class:"flex justify-end gap-4"},ye=["disabled"],we={key:1},je={key:2},ke={key:3},qe={key:4},Se={key:5},Ie={__name:"Edit",setup(Ue){const y=["Settings","Analytics","Emails","Donations","Images","Participant"],u=_("Settings"),c=_(window.location.pathname.split("/").slice(-2,-1)[0]),m=_(!1),v=_(""),t=_({name:{de:"",fr:""},description:{de:"",fr:""},location:"",language:"",start:"",end:"",allow_donation_until:"",image_landscape:null,image_square:null,image_landscape_url:"",image_square_url:"",flat_rate_enabled:!1,flat_rate_min_amount:"",flat_rate_help_text:"",unit_based_enabled:!1,public_donation_enabled:!1}),o=P().props,U=C(()=>o.project||{});function w(n){u.value=n;const e=new URL(window.location);e.searchParams.set("tab",n),window.history.pushState({},"",e)}function j(n,e){const l=n.target.files[0];if(l){e==="image_landscape"?t.value.image_landscape=l:e==="image_square"&&(t.value.image_square=l);const g=new FileReader;g.onload=I=>{e==="image_landscape"?t.value.image_landscape_url=I.target.result:e==="image_square"&&(t.value.image_square_url=I.target.result)},g.readAsDataURL(l)}}function k(){t.value.name={de:t.value.name.de||"",fr:t.value.name.fr||""}}function q(){t.value.description={de:t.value.description.de||"",fr:t.value.description.fr||""}}function S(){o.project?(t.value.name=o.project.name||{de:"",fr:""},t.value.description=o.project.description||{de:"",fr:""},t.value.location=o.project.location||"",t.value.language=o.project.language||"",t.value.start=o.project.start?new Date(o.project.start).toISOString().slice(0,16):"",t.value.end=o.project.end?new Date(o.project.end).toISOString().slice(0,16):"",t.value.allow_donation_until=o.project.allow_donation_until?new Date(o.project.allow_donation_until).toISOString().slice(0,16):"",t.value.flat_rate_enabled=!!o.project.flat_rate_enabled,t.value.flat_rate_min_amount=o.project.flat_rate_min_amount||"",t.value.flat_rate_help_text=o.project.flat_rate_help_text||"",t.value.unit_based_enabled=!!o.project.unit_based_enabled,t.value.public_donation_enabled=!!o.project.public_donation_enabled,t.value.image_landscape_url=o.project.image_landscape||"",t.value.image_square_url=o.project.image_square||""):v.value="Project not found.",m.value=!1}async function V(){m.value=!0,v.value="";try{const n=new FormData;n.append("name",JSON.stringify(t.value.name)),n.append("description",JSON.stringify(t.value.description)),n.append("location",t.value.location),n.append("language",t.value.language),n.append("start",t.value.start),n.append("end",t.value.end),n.append("allow_donation_until",t.value.allow_donation_until),n.append("flat_rate_enabled",t.value.flat_rate_enabled?"1":"0"),n.append("flat_rate_min_amount",t.value.flat_rate_min_amount||""),n.append("flat_rate_help_text",t.value.flat_rate_help_text||""),n.append("unit_based_enabled",t.value.unit_based_enabled?"1":"0"),n.append("public_donation_enabled",t.value.public_donation_enabled?"1":"0"),t.value.image_landscape&&n.append("image_landscape",t.value.image_landscape),t.value.image_square&&n.append("image_square",t.value.image_square);const e=R("projects.update",{project:c.value});await H.post(e,n,{headers:{"Content-Type":"multipart/form-data"},method:"PUT"}),alert("Project updated!")}catch(n){v.value=`Failed to update project: ${n.message}`,console.error("Error updating project:",n)}finally{m.value=!1}}function D(){window.history.back()}return F(()=>{S();const e=new URLSearchParams(window.location.search).get("tab");e&&y.includes(e)&&w(e)}),A(()=>o.project,n=>{n&&S()}),(n,e)=>(s(),b($,null,{default:E(()=>[a("div",W,[a("h1",X,f(t.value.name.de||t.value.name[Object.keys(t.value.name)[0]]||"Edit project"),1),a("div",Y,[(s(),r(T,null,L(y,l=>a("button",{key:l,onClick:g=>w(l),class:M(["px-4 py-2 -mb-px font-medium",u.value===l?"border-b-2 border-purple-600 text-purple-600":"text-gray-500"])},f(l),11,Z)),64))]),m.value?(s(),r("div",ee,"Loading...")):v.value?(s(),r("div",te,f(v.value),1)):(s(),r("div",ae,[u.value==="Settings"?(s(),r("div",le,[a("form",{onSubmit:N(V,["prevent"]),class:"space-y-8"},[a("div",ne,[e[27]||(e[27]=a("h2",{class:"font-semibold text-lg mb-4"},"Project info",-1)),a("div",oe,[a("div",null,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Project name*",-1)),i(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.name.de=l),type:"text",class:"input w-full",required:"",onInput:k},null,544),[[d,t.value.name.de]]),i(a("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.name.fr=l),type:"text",class:"input w-full mt-2",onInput:k},null,544),[[d,t.value.name.fr]])]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),i(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.location=l),type:"text",class:"input w-full"},null,512),[[d,t.value.location]])]),a("div",null,[e[19]||(e[19]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Language*",-1)),i(a("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.language=l),class:"input w-full",required:""},e[18]||(e[18]=[a("option",{value:"de"},"German",-1),a("option",{value:"fr"},"French",-1)]),512),[[O,t.value.language]])]),e[23]||(e[23]=a("div",null,null,-1)),a("div",null,[e[20]||(e[20]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Start*",-1)),i(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.start=l),type:"datetime-local",class:"input w-full",required:""},null,512),[[d,t.value.start]])]),a("div",null,[e[21]||(e[21]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"End*",-1)),i(a("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.end=l),type:"datetime-local",class:"input w-full",required:""},null,512),[[d,t.value.end]])]),a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Allow donation until*",-1)),i(a("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.allow_donation_until=l),type:"datetime-local",class:"input w-full",required:""},null,512),[[d,t.value.allow_donation_until]])])]),a("div",se,[e[24]||(e[24]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Project description*",-1)),i(a("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.description.de=l),rows:"5",class:"input w-full",required:"",onInput:q},null,544),[[d,t.value.description.de]]),i(a("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.description.fr=l),rows:"5",class:"input w-full mt-2",onInput:q},null,544),[[d,t.value.description.fr]])]),a("div",ie,[a("div",null,[e[25]||(e[25]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Project image landscape format (1200x300px)*",-1)),a("input",{type:"file",onChange:e[9]||(e[9]=l=>j(l,"image_landscape")),class:"input w-full",accept:"image/*"},null,32),t.value.image_landscape_url?(s(),r("div",re,[a("img",{src:t.value.image_landscape_url,alt:"Landscape preview",class:"rounded border max-w-full h-48 object-cover"},null,8,ue)])):p("",!0)]),a("div",null,[e[26]||(e[26]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Project image square (400x400px)*",-1)),a("input",{type:"file",onChange:e[10]||(e[10]=l=>j(l,"image_square")),class:"input w-full",accept:"image/*"},null,32),t.value.image_square_url?(s(),r("div",de,[a("img",{src:t.value.image_square_url,alt:"Square preview",class:"rounded border w-48 h-48 object-cover"},null,8,pe)])):p("",!0)])])]),a("div",me,[a("div",ce,[e[28]||(e[28]=a("h2",{class:"font-semibold text-lg flex-1"},"Flat-rate donations",-1)),i(a("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=l=>t.value.flat_rate_enabled=l),class:"mr-2",id:"flat_rate_enabled"},null,512),[[x,t.value.flat_rate_enabled]]),e[29]||(e[29]=a("label",{for:"flat_rate_enabled",class:"text-sm"},"Activate flat-rate donations",-1))]),e[32]||(e[32]=a("p",{class:"text-sm text-gray-600 mb-2"},"Enable flat-rate donations. For example, a flat rate of CHF 20 for one participant.",-1)),t.value.flat_rate_enabled?(s(),r("div",ve,[a("div",null,[e[30]||(e[30]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Minimum amount (CHF)",-1)),i(a("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.flat_rate_min_amount=l),type:"number",min:"0",step:"0.01",class:"input w-full"},null,512),[[d,t.value.flat_rate_min_amount]])]),a("div",null,[e[31]||(e[31]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Help text",-1)),i(a("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>t.value.flat_rate_help_text=l),type:"text",class:"input w-full"},null,512),[[d,t.value.flat_rate_help_text]])])])):p("",!0)]),a("div",_e,[a("div",be,[e[33]||(e[33]=a("h2",{class:"font-semibold text-lg flex-1"},"Unit-based donations",-1)),i(a("input",{type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=l=>t.value.unit_based_enabled=l),class:"mr-2",id:"unit_based_enabled"},null,512),[[x,t.value.unit_based_enabled]]),e[34]||(e[34]=a("label",{for:"unit_based_enabled",class:"text-sm"},"Allow unit-based donations",-1))]),e[35]||(e[35]=a("p",{class:"text-sm text-gray-600"},"Allow unit-based donations. For example, CHF 1 per lap run or per kg of waste paper collected.",-1))]),a("div",fe,[a("div",ge,[e[36]||(e[36]=a("h2",{class:"font-semibold text-lg flex-1"},"Public project donation page, banner and poster",-1)),i(a("input",{type:"checkbox","onUpdate:modelValue":e[15]||(e[15]=l=>t.value.public_donation_enabled=l),class:"mr-2",id:"public_donation_enabled"},null,512),[[x,t.value.public_donation_enabled]]),e[37]||(e[37]=a("label",{for:"public_donation_enabled",class:"text-sm"},"Allow public project donations",-1))]),e[38]||(e[38]=a("p",{class:"text-sm text-gray-600"},"Receive a link to your project with an integrated donation form. Donations received through this form cannot be allocated to any member. Share this page on your channels to promote the project and receive additional donations.",-1))]),a("div",xe,[a("button",{type:"button",onClick:D,class:"px-6 py-2 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 transition"},"Cancel"),a("button",{type:"submit",class:"px-6 py-2 rounded bg-purple-600 text-white font-semibold hover:bg-purple-700 transition",disabled:m.value},f(m.value?"Saving...":"Save"),9,ye)])],32)])):u.value==="Analytics"?(s(),r("div",we,[u.value==="Analytics"?(s(),b(z,{key:0,projectId:c.value},null,8,["projectId"])):p("",!0)])):u.value==="Emails"?(s(),r("div",je,[u.value==="Emails"?(s(),b(J,{key:0,projectId:c.value},null,8,["projectId"])):p("",!0)])):u.value==="Donations"?(s(),r("div",ke,[u.value==="Donations"?(s(),b(h,{key:0,project:U.value,filters:{}},null,8,["project"])):p("",!0)])):u.value==="Images"?(s(),r("div",qe,[u.value==="Images"?(s(),b(G,{key:0,projectId:c.value},null,8,["projectId"])):p("",!0)])):u.value==="Participant"?(s(),r("div",Se,[B(K,{projectId:c.value},null,8,["projectId"])])):p("",!0)]))])]),_:1}))}},Ne=Q(Ie,[["__scopeId","data-v-92ed83b5"]]);export{Ne as default};
