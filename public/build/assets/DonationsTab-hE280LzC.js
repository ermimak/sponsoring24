import{p as le,r as v,s as se,z as $,d,o as p,a as t,e as y,b as V,f as b,q as F,v as x,h as R,t as u,g as G,F as A,j as D,y as j,E,k as ae,u as oe}from"./app-BDDThPdq.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const ne={class:"bg-white shadow rounded-lg p-6 mb-6"},re={class:"bg-white shadow rounded-lg p-6"},ue={class:"flex justify-between items-center mb-4"},de={class:"text-xl font-semibold"},pe={class:"text-gray-500"},me={class:"space-x-2"},ce=["disabled"],ve=["disabled"],be={class:"min-w-full divide-y divide-gray-200 bg-white rounded-lg border mb-4"},ge={class:"bg-gray-50"},fe={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ye={class:"px-6 py-4 whitespace-nowrap"},xe=["value"],we={class:"px-6 py-4 whitespace-nowrap"},_e={class:"px-6 py-4 whitespace-nowrap"},he={class:"px-6 py-4 whitespace-nowrap"},ke={class:"px-6 py-4 whitespace-nowrap"},je={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Se={class:"flex justify-end space-x-2"},Me=["onClick"],Te=["href"],Ce={key:0},Ue={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Ve={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto"},Fe={class:"mb-4"},Ae=["value"],De={class:"mb-4"},Ie={class:"mb-4"},Ne={class:"flex justify-end space-x-4"},Be=["disabled"],Le={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Pe={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto"},qe={class:"text-xl font-bold mb-4"},Oe={class:"mb-4"},ze=["value"],$e={class:"mb-4"},Re={class:"mb-4"},Ge={class:"flex justify-end space-x-4"},Je=["disabled"],He={key:2,class:"fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg"},Ye={key:3,class:"fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg"},Ke={key:4,class:"fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center"},Qe={__name:"DonationsTab",props:{project:Object,filters:Object,donations:Array},setup(J){var q,O;const m=J,I=le(),h=v([]),i=v({status:m.filters.status||"",date_from:m.filters.date_from||"",date_to:m.filters.date_to||"",amount_min:m.filters.amount_min||"",amount_max:m.filters.amount_max||""}),c=v([]),w=v(!1),M=v(!1),T=v(!1),k=v(null),g=v([]),f=v(!1),n=v({template_id:"",subject:"",body:""}),r=v({template_id:"",subject:"",body:""}),S=v(!1),o=v({success:((q=I.props.flash)==null?void 0:q.success)||"",error:((O=I.props.flash)==null?void 0:O.error)||"",loading:""}),N=l=>{o.value.success=l,setTimeout(()=>{o.value.success=""},5e3)},_=l=>{o.value.error=l,setTimeout(()=>{o.value.error=""},5e3)},B=l=>{o.value.loading=l,setTimeout(()=>{o.value.loading=""},3e3)},H=(l,e)=>{let a;return(...s)=>{clearTimeout(a),a=setTimeout(()=>l(...s),e)}},C=async()=>{try{console.log("Fetching email templates for project:",m.project.id);const l=await j.get("/dashboard/email-templates",{params:{project_id:m.project.id}});console.log("Email templates response:",l.data),g.value=l.data.data||l.data,console.log("Email templates loaded:",g.value.length)}catch(l){console.error("Error fetching email templates:",l)}},U=H(async()=>{try{const l=await j.get(E("dashboard.project.donations.fetch",m.project.id),{params:{status:i.value.status,date_from:i.value.date_from,date_to:i.value.date_to,amount_min:i.value.amount_min,amount_max:i.value.amount_max}});h.value=l.data.data||l.data.map(e=>({id:e.id,donor_name:e.supporter_email??"Anonymous",amount:e.amount,currency:e.currency,date:e.billing_date?e.billing_date.format("Y-m-d"):null,status:e.status,participant_name:e.participant?(e.participant.first_name??"")+" "+(e.participant.last_name??""):"N/A",participant_id:e.participant_id})),c.value=[],w.value=!1}catch(l){console.error("Failed to fetch donations:",l),h.value=[],c.value=[],w.value=!1}},300);function Y(){w.value?c.value=h.value.map(l=>l.id):c.value=[]}const K=async()=>{if(n.value.template_id)try{const l=g.value.find(e=>e.id===n.value.template_id);l&&(n.value.subject=l.subject||"",n.value.body=l.body||"")}catch(l){console.error("Error loading template:",l)}},Q=async()=>{if(r.value.template_id)try{const l=g.value.find(e=>e.id===r.value.template_id);l&&(r.value.subject=l.subject||"",r.value.body=l.body||"")}catch(l){console.error("Error loading template:",l)}},W=async()=>{if(c.value.length===0){_("Please select at least one donation to send emails");return}n.value={template_id:"",subject:"",body:""},B("Loading email templates..."),await C(),g.value.length===0&&_("No email templates found for this project. Please create at least one template."),M.value=!0},L=()=>{M.value=!1,n.value={template_id:"",subject:"",body:""}},X=async l=>{k.value=l,r.value={template_id:"",subject:"",body:""},B("Loading email templates..."),await C(),g.value.length===0&&_("No email templates found for this project. Please create at least one template."),T.value=!0},P=()=>{T.value=!1,k.value=null,r.value={template_id:"",subject:"",body:""}},Z=async()=>{var l,e;if(!n.value.template_id){_("Please select an email template."),setTimeout(()=>{o.value.error=""},3e3);return}f.value=!0;try{const a=await j.post(E("project.donations.massEmail",m.project.id),{donation_ids:c.value,template_id:n.value.template_id,subject:n.value.subject,body:n.value.body});L(),c.value=[],w.value=!1,N(`Mass email sent successfully. ${a.data.results.success} sent, ${a.data.results.failed} failed, ${a.data.results.skipped} skipped.`),setTimeout(()=>{o.value.success=""},5e3)}catch(a){console.error("Error sending mass email:",a),_(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.error)||"Failed to send mass email."),setTimeout(()=>{o.value.error=""},5e3)}finally{f.value=!1}},ee=async()=>{var l,e;if(!r.value.template_id||!k.value){_("Please select an email template."),setTimeout(()=>{o.value.error=""},3e3);return}f.value=!0;try{const a=await j.post(E("project.donations.sendEmail",{projectId:m.project.id,donationId:k.value.id}),{template_id:r.value.template_id,subject:r.value.subject,body:r.value.body,project_id:m.project.id});P(),N("Email sent successfully."),setTimeout(()=>{o.value.success=""},3e3)}catch(a){console.error("Error sending email:",a),_(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.error)||"Failed to send email."),setTimeout(()=>{o.value.error=""},3e3)}finally{f.value=!1}},te=async()=>{if(c.value.length!==0){S.value=!0;try{const l=await j.post(E("project.donations.bulkInvoice",m.project.id),{donation_ids:c.value},{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([l.data],{type:"application/pdf"})),a=document.createElement("a");a.href=e,a.setAttribute("download",`bulk_invoice_${m.project.id}_${new Date().toISOString().slice(0,10)}.pdf`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e),c.value=[],w.value=!1,alert("Bulk invoice generated successfully!")}catch(l){console.error("Failed to generate bulk invoice:",l),alert("Failed to generate bulk invoice. Please try again.")}finally{S.value=!1}}};return se(()=>{U(),C()}),$(()=>m.project.id,l=>{l&&U()}),$(i,(l,e)=>{JSON.stringify(l)!==JSON.stringify(e)&&U()},{deep:!0}),(l,e)=>{var a;return p(),d("div",null,[t("div",ne,[e[21]||(e[21]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Filters",-1)),t("form",{onSubmit:e[5]||(e[5]=V((...s)=>l.applyFilters&&l.applyFilters(...s),["prevent"])),class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.value.status=s),class:"input w-full"},e[14]||(e[14]=[t("option",{value:""},"All",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"completed"},"Completed",-1)]),512),[[F,i.value.status]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date From",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.date_from=s),type:"date",class:"input w-full"},null,512),[[x,i.value.date_from]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date To",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.date_to=s),type:"date",class:"input w-full"},null,512),[[x,i.value.date_to]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Amount Min",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.amount_min=s),type:"number",step:"0.01",class:"input w-full"},null,512),[[x,i.value.amount_min]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Amount Max",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.amount_max=s),type:"number",step:"0.01",class:"input w-full"},null,512),[[x,i.value.amount_max]])]),e[20]||(e[20]=t("div",{class:"flex items-end"},[t("button",{type:"submit",class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"},"Apply Filters")],-1))],32)]),t("div",re,[t("div",ue,[t("h2",de,[e[22]||(e[22]=R(" Donations ")),t("span",pe,"("+u(h.value.length)+" entries)",1)]),t("div",me,[t("button",{onClick:W,disabled:c.value.length===0,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"}," Mass Email ",8,ce),t("button",{onClick:te,disabled:c.value.length===0||S.value,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"},u(S.value?"Generating...":"Bulk Invoice"),9,ve)])]),t("table",be,[t("thead",ge,[t("tr",null,[t("th",fe,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),onChange:Y},null,544),[[G,w.value]])]),e[23]||(e[23]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Donor",-1)),e[24]||(e[24]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Participant",-1)),e[25]||(e[25]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Amount",-1)),e[26]||(e[26]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date",-1)),e[27]||(e[27]=t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status",-1)),e[28]||(e[28]=t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions",-1))])]),t("tbody",null,[(p(!0),d(A,null,D(h.value,s=>(p(),d("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",ye,[b(t("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[7]||(e[7]=z=>c.value=z)},null,8,xe),[[G,c.value]])]),t("td",we,u(s.donor_name),1),t("td",_e,u(s.participant_name),1),t("td",he,u(s.amount)+" "+u(s.currency),1),t("td",ke,u(s.date),1),t("td",je,[t("span",{class:ae([{"bg-green-100 text-green-800":s.status==="completed","bg-yellow-100 text-yellow-800":s.status==="pending"},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},u(s.status),3)]),t("td",Ee,[t("div",Se,[s.donor_email?(p(),d("button",{key:0,onClick:z=>X(s),class:"text-purple-600 hover:text-purple-900",title:"Send Email"},e[29]||(e[29]=[t("i",{class:"fas fa-envelope"},null,-1)]),8,Me)):y("",!0),s.participant_id?(p(),d("a",{key:1,href:oe(E)("donations.preview",{donation:s.id}),target:"_blank",class:"text-purple-600 hover:text-purple-900",title:"To the invoice page"},e[30]||(e[30]=[t("i",{class:"fas fa-file-invoice-dollar"},null,-1)]),8,Te)):y("",!0)])])]))),128)),h.value.length===0?(p(),d("tr",Ce,e[31]||(e[31]=[t("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-400"},"No donations found 😊",-1)]))):y("",!0)])])]),M.value?(p(),d("div",Ue,[t("div",Ve,[e[36]||(e[36]=t("h2",{class:"text-xl font-bold mb-4"},"Send Mass Email",-1)),t("form",{onSubmit:V(Z,["prevent"])},[t("div",Fe,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email Template",-1)),b(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.template_id=s),class:"input w-full",required:"",onChange:K},[e[32]||(e[32]=t("option",{value:""},"Select a template",-1)),(p(!0),d(A,null,D(g.value,s=>(p(),d("option",{key:s.id,value:s.id},u(s.name),9,Ae))),128))],544),[[F,n.value.template_id]])]),t("div",De,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700"},"Subject",-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.subject=s),type:"text",class:"input w-full",required:""},null,512),[[x,n.value.subject]])]),t("div",Ie,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700"},"Message",-1)),b(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.body=s),class:"input w-full",rows:"6",required:""},null,512),[[x,n.value.body]])]),t("div",Ne,[t("button",{onClick:L,type:"button",class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",disabled:f.value,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"},u(f.value?"Sending...":"Send"),9,Be)])],32)])])):y("",!0),T.value?(p(),d("div",Le,[t("div",Pe,[t("h2",qe,"Send Email to "+u((a=k.value)==null?void 0:a.donor_name),1),t("form",{onSubmit:V(ee,["prevent"])},[t("div",Oe,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email Template",-1)),b(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>r.value.template_id=s),class:"input w-full",required:"",onChange:Q},[e[37]||(e[37]=t("option",{value:""},"Select a template",-1)),(p(!0),d(A,null,D(g.value,s=>(p(),d("option",{key:s.id,value:s.id},u(s.name),9,ze))),128))],544),[[F,r.value.template_id]])]),t("div",$e,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700"},"Subject",-1)),b(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>r.value.subject=s),type:"text",class:"input w-full",required:""},null,512),[[x,r.value.subject]])]),t("div",Re,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700"},"Message",-1)),b(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>r.value.body=s),class:"input w-full",rows:"6",required:""},null,512),[[x,r.value.body]])]),t("div",Ge,[t("button",{onClick:P,type:"button",class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",disabled:f.value,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded disabled:opacity-50"},u(f.value?"Sending...":"Send"),9,Je)])],32)])])):y("",!0),o.value.success?(p(),d("div",He,u(o.value.success),1)):y("",!0),o.value.error?(p(),d("div",Ye,u(o.value.error),1)):y("",!0),o.value.loading?(p(),d("div",Ke,[e[41]||(e[41]=t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),R(" "+u(o.value.loading),1)])):y("",!0)])}}},et=ie(Qe,[["__scopeId","data-v-105cfb80"]]);export{et as default};
