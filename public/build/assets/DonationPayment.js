import{k as g,o as f,f as e,y as p,t as m,n as h,i as v,j as S,q as I,v as P,N as M,m as u,I as D,U as N,R as B,a as w,W as k}from"./vendor.js";import{_ as V}from"./_plugin-vue_export-helper.js";const O={__name:"DonationPayment",props:{project:Object,participant:Object,donation:Object},setup(C,{expose:t}){var T;t();const o=C,n=M(),y=u(null),l=u(!1),r=u(null),b=u(null),c=u(null),j=u({name:"",address:"",email:((T=o.donation)==null?void 0:T.supporter_email)||""});D(async()=>{var i;try{const a=n.props.stripeKey||((i=window.config)==null?void 0:i.stripeKey)||"pk_test_51RbbtsAc8DSpEFrZEjKJzXR7xRrhCOHEmS5HYVa9MIzeh6jpx6F36LvGkBDbhtjZjZHNpdPjCEbIubHY3bXYJ8Q7006xSd2JEW";if(console.log("Using Stripe key:",a),r.value=await N(a),!r.value){console.error("Failed to initialize Stripe");return}b.value=r.value.elements()}catch(a){console.error("Error initializing Stripe:",a)}}),B(y,i=>{i==="card"&&r.value&&b.value&&!c.value&&setTimeout(()=>{try{c.value=b.value.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),document.getElementById("card-element")?(c.value.mount("#card-element"),c.value.on("change",s=>{const d=document.getElementById("card-errors");d&&(s.error?d.textContent=s.error.message:d.textContent="")})):console.error("Card element container not found in DOM")}catch(a){console.error("Error mounting card element:",a)}},100)});function W(i){y.value=i}async function U(){var a,s;if(!r.value||!c.value){console.error("Stripe not initialized");return}l.value=!0;const i=document.getElementById("card-errors");try{const d=await w.post("/api/payments/create-payment-intent",{amount:o.donation.amount,currency:o.donation.currency.toLowerCase(),donation_id:o.donation.id,payment_method:"card"}),{clientSecret:E}=d.data;if(!E)throw new Error("No client secret returned from the server");const x=await r.value.confirmCardPayment(E,{payment_method:{card:c.value,billing_details:{email:o.donation.supporter_email}}});x.error?i.textContent=x.error.message:x.paymentIntent.status==="succeeded"&&k.visit(route("participant.donate.success",{projectId:o.project.id,participantId:o.participant.id,donationId:o.donation.id}))}catch(d){console.error("Payment failed:",d),i.textContent=((s=(a=d.response)==null?void 0:a.data)==null?void 0:s.error)||"An error occurred while processing your payment. Please try again."}finally{l.value=!1}}async function q(){l.value=!0;try{const i=await w.post("/api/payments/create-payment-intent",{amount:o.donation.amount,currency:o.donation.currency.toLowerCase(),donation_id:o.donation.id,payment_method:"twint"}),{clientSecret:a}=i.data;if(!a)throw new Error("No client secret returned from the server");const{error:s}=await r.value.redirectToCheckout({paymentIntentClientSecret:a,successUrl:window.location.origin+route("participant.donate.success",{projectId:o.project.id,participantId:o.participant.id,donationId:o.donation.id}),cancelUrl:window.location.origin+route("participant.donate.payment",{projectId:o.project.id,participantId:o.participant.id,donationId:o.donation.id})});if(s)throw s}catch(i){console.error("TWINT payment failed:",i),alert("TWINT payment failed: "+(i.message||"Unknown error")),l.value=!1}}async function F(){var i,a;l.value=!0;try{await w.post("/api/payments/request-invoice",{donation_id:o.donation.id,billing_info:j.value}),k.visit(route("participant.donate.invoice.success",{projectId:o.project.id,participantId:o.participant.id,donationId:o.donation.id}))}catch(s){console.error("Invoice request failed:",s),alert("Failed to request invoice: "+(((a=(i=s.response)==null?void 0:i.data)==null?void 0:a.error)||"Unknown error"))}finally{l.value=!1}}function z(){window.history.back()}const _={props:o,page:n,selectedMethod:y,processing:l,stripe:r,elements:b,cardElement:c,invoiceData:j,selectPaymentMethod:W,handleCardPayment:U,handleTwintPayment:q,handleInvoicePayment:F,goBack:z,ref:u,onMounted:D,watch:B,get usePage(){return M},get loadStripe(){return N},get router(){return k},get axios(){return w}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}},R={class:"min-h-screen bg-gray-50 flex flex-col items-center justify-center"},A={class:"bg-white shadow-lg rounded-lg p-8 w-full max-w-md mt-10"},H={class:"text-3xl font-bold text-center mb-6"},K={class:"space-y-4 mb-8"},J={key:0,class:"mt-6"},L=["disabled"],Y={key:1,class:"mt-6"},Z=["disabled"],X={key:2,class:"mt-6"},G={class:"mb-4"},Q={class:"mb-4"},$={class:"mb-4"},ee=["disabled"];function te(C,t,o,n,y,l){return f(),g("div",R,[e("div",A,[e("h1",H," Pay "+m(o.donation.amount)+" "+m(o.donation.currency)+" now via ",1),e("div",K,[e("button",{onClick:t[0]||(t[0]=r=>n.selectPaymentMethod("invoice")),class:h([{"bg-purple-50 border-purple-500":n.selectedMethod==="invoice"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},t[6]||(t[6]=[e("span",{class:"mr-3"},[e("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2","stroke-width":"2"})])],-1),v(" The invoice ")]),2),e("button",{onClick:t[1]||(t[1]=r=>n.selectPaymentMethod("twint")),class:h([{"bg-purple-50 border-purple-500":n.selectedMethod==="twint"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},t[7]||(t[7]=[e("span",{class:"mr-3"},[e("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"})])],-1),v(" TWINT ")]),2),e("button",{onClick:t[2]||(t[2]=r=>n.selectPaymentMethod("card")),class:h([{"bg-purple-50 border-purple-500":n.selectedMethod==="card"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},t[8]||(t[8]=[e("span",{class:"mr-3"},[e("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[e("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2","stroke-width":"2"}),e("rect",{x:"6",y:"10",width:"4",height:"4","stroke-width":"2"})])],-1),v(" Credit or debit card ")]),2)]),p(" Credit Card Payment Form "),n.selectedMethod==="card"?(f(),g("div",J,[e("form",{id:"payment-form",onSubmit:S(n.handleCardPayment,["prevent"])},[t[9]||(t[9]=e("div",{id:"card-element",class:"p-3 border rounded-lg mb-4 bg-white min-h-[40px]"},null,-1)),t[10]||(t[10]=e("div",{id:"card-errors",class:"text-red-500 text-sm mb-4",role:"alert"},null,-1)),e("button",{type:"submit",disabled:n.processing,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(n.processing?"Processing...":`Pay ${o.donation.amount} ${o.donation.currency}`),9,L)],32)])):p("v-if",!0),p(" TWINT Payment Form "),n.selectedMethod==="twint"?(f(),g("div",Y,[t[11]||(t[11]=e("div",{class:"bg-blue-50 p-4 rounded-lg mb-4"},[e("p",{class:"text-center"},"TWINT payment will be processed via Stripe."),e("div",{class:"flex justify-center my-4"},[e("div",{class:"h-12 flex items-center justify-center bg-blue-500 text-white font-bold rounded px-4 py-2"}," TWINT ")])],-1)),e("button",{onClick:n.handleTwintPayment,disabled:n.processing,class:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(n.processing?"Processing...":"Pay with TWINT"),9,Z)])):p("v-if",!0),p(" Invoice Payment Form "),n.selectedMethod==="invoice"?(f(),g("div",X,[t[15]||(t[15]=e("div",{class:"bg-gray-50 p-4 rounded-lg mb-4"},[e("p",{class:"text-center"},"An invoice will be sent to your email address."),e("p",{class:"text-center text-sm text-gray-500 mt-2"},"Please provide your billing information below:")],-1)),e("form",{onSubmit:S(n.handleInvoicePayment,["prevent"])},[e("div",G,[t[12]||(t[12]=e("label",{for:"billing-name",class:"block text-sm font-medium text-gray-700 mb-1"},"Full Name",-1)),I(e("input",{type:"text",id:"billing-name","onUpdate:modelValue":t[3]||(t[3]=r=>n.invoiceData.name=r),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[P,n.invoiceData.name]])]),e("div",Q,[t[13]||(t[13]=e("label",{for:"billing-address",class:"block text-sm font-medium text-gray-700 mb-1"},"Address",-1)),I(e("input",{type:"text",id:"billing-address","onUpdate:modelValue":t[4]||(t[4]=r=>n.invoiceData.address=r),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[P,n.invoiceData.address]])]),e("div",$,[t[14]||(t[14]=e("label",{for:"billing-email",class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),I(e("input",{type:"email",id:"billing-email","onUpdate:modelValue":t[5]||(t[5]=r=>n.invoiceData.email=r),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[P,n.invoiceData.email]])]),e("button",{type:"submit",disabled:n.processing,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(n.processing?"Processing...":"Request Invoice"),9,ee)],32)])):p("v-if",!0),e("div",{class:"flex justify-center mt-6"},[e("button",{onClick:n.goBack,class:"border border-red-500 text-red-600 px-6 py-2 rounded-lg flex items-center hover:bg-red-50 transition"},t[16]||(t[16]=[e("span",{class:"mr-2"},"‚Üê",-1),v(" Back ")]))])])])}const re=V(O,[["render",te],["__scopeId","data-v-9cb0cba8"],["__file","/var/www/html/resources/js/Pages/Projects/Participants/DonationPayment.vue"]]);export{re as default};
