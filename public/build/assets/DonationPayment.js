import{O as q,e as u,I as V,V as D,R as M,l as y,o as b,g as t,y as x,t as m,n as h,j as v,k as P,p as k,v as I,a as C,W as E}from"./vendor.js";import{_ as z}from"./_plugin-vue_export-helper.js";const O={class:"min-h-screen bg-gray-50 flex flex-col items-center justify-center"},_={class:"bg-white shadow-lg rounded-lg p-8 w-full max-w-md mt-10"},$={class:"text-3xl font-bold text-center mb-6"},A={class:"space-y-4 mb-8"},F={key:0,class:"mt-6"},K=["disabled"],L={key:1,class:"mt-6"},R=["disabled"],G={key:2,class:"mt-6"},H={class:"mb-4"},J={class:"mb-4"},Q={class:"mb-4"},X=["disabled"],Y={__name:"DonationPayment",props:{project:Object,participant:Object,donation:Object},setup(p){var T;const r=p,S=q(),a=u(null),i=u(!1),s=u(null),g=u(null),c=u(null),d=u({name:"",address:"",email:((T=r.donation)==null?void 0:T.supporter_email)||""});V(async()=>{var o;try{const e=S.props.stripeKey||((o=window.config)==null?void 0:o.stripeKey)||void 0;if(console.log("Using Stripe key:",e),!e){console.error("Stripe public key is not configured. Please check your environment variables.");return}if(s.value=await D(e),!s.value){console.error("Failed to initialize Stripe");return}g.value=s.value.elements()}catch(e){console.error("Error initializing Stripe:",e)}}),M(a,o=>{o==="card"&&s.value&&g.value&&!c.value&&setTimeout(()=>{try{c.value=g.value.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),document.getElementById("card-element")?(c.value.mount("#card-element"),c.value.on("change",n=>{const l=document.getElementById("card-errors");l&&(n.error?l.textContent=n.error.message:l.textContent="")})):console.error("Card element container not found in DOM")}catch(e){console.error("Error mounting card element:",e)}},100)});function f(o){a.value=o}async function N(){var e,n;if(!s.value||!c.value){console.error("Stripe not initialized");return}i.value=!0;const o=document.getElementById("card-errors");try{const l=await C.post("/api/payments/create-payment-intent",{amount:r.donation.amount,currency:r.donation.currency.toLowerCase(),donation_id:r.donation.id,payment_method:"card"}),{clientSecret:j}=l.data;if(!j)throw new Error("No client secret returned from the server");const w=await s.value.confirmCardPayment(j,{payment_method:{card:c.value,billing_details:{email:r.donation.supporter_email}}});w.error?o.textContent=w.error.message:w.paymentIntent.status==="succeeded"&&E.visit(route("participant.donate.success",{projectId:r.project.id,participantId:r.participant.id,donationId:r.donation.id}))}catch(l){console.error("Payment failed:",l),o.textContent=((n=(e=l.response)==null?void 0:e.data)==null?void 0:n.error)||"An error occurred while processing your payment. Please try again."}finally{i.value=!1}}async function B(){i.value=!0;try{const o=await C.post("/api/payments/create-payment-intent",{amount:r.donation.amount,currency:r.donation.currency.toLowerCase(),donation_id:r.donation.id,payment_method:"twint"}),{clientSecret:e}=o.data;if(!e)throw new Error("No client secret returned from the server");const{error:n}=await s.value.redirectToCheckout({paymentIntentClientSecret:e,successUrl:window.location.origin+route("participant.donate.success",{projectId:r.project.id,participantId:r.participant.id,donationId:r.donation.id}),cancelUrl:window.location.origin+route("participant.donate.payment",{projectId:r.project.id,participantId:r.participant.id,donationId:r.donation.id})});if(n)throw n}catch(o){console.error("TWINT payment failed:",o),alert("TWINT payment failed: "+(o.message||"Unknown error")),i.value=!1}}async function U(){var o,e;i.value=!0;try{await C.post("/api/payments/request-invoice",{donation_id:r.donation.id,billing_info:d.value}),E.visit(route("participant.donate.invoice.success",{projectId:r.project.id,participantId:r.participant.id,donationId:r.donation.id}))}catch(n){console.error("Invoice request failed:",n),alert("Failed to request invoice: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.error)||"Unknown error"))}finally{i.value=!1}}function W(){window.history.back()}return(o,e)=>(b(),y("div",O,[t("div",_,[t("h1",$," Pay "+m(p.donation.amount)+" "+m(p.donation.currency)+" now via ",1),t("div",A,[t("button",{onClick:e[0]||(e[0]=n=>f("invoice")),class:h([{"bg-purple-50 border-purple-500":a.value==="invoice"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},e[6]||(e[6]=[t("span",{class:"mr-3"},[t("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[t("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2","stroke-width":"2"})])],-1),v(" The invoice ")]),2),t("button",{onClick:e[1]||(e[1]=n=>f("twint")),class:h([{"bg-purple-50 border-purple-500":a.value==="twint"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},e[7]||(e[7]=[t("span",{class:"mr-3"},[t("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"})])],-1),v(" TWINT ")]),2),t("button",{onClick:e[2]||(e[2]=n=>f("card")),class:h([{"bg-purple-50 border-purple-500":a.value==="card"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},e[8]||(e[8]=[t("span",{class:"mr-3"},[t("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[t("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2","stroke-width":"2"}),t("rect",{x:"6",y:"10",width:"4",height:"4","stroke-width":"2"})])],-1),v(" Credit or debit card ")]),2)]),a.value==="card"?(b(),y("div",F,[t("form",{id:"payment-form",onSubmit:P(N,["prevent"])},[e[9]||(e[9]=t("div",{id:"card-element",class:"p-3 border rounded-lg mb-4 bg-white min-h-[40px]"},null,-1)),e[10]||(e[10]=t("div",{id:"card-errors",class:"text-red-500 text-sm mb-4",role:"alert"},null,-1)),t("button",{type:"submit",disabled:i.value,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(i.value?"Processing...":`Pay ${p.donation.amount} ${p.donation.currency}`),9,K)],32)])):x("",!0),a.value==="twint"?(b(),y("div",L,[e[11]||(e[11]=t("div",{class:"bg-blue-50 p-4 rounded-lg mb-4"},[t("p",{class:"text-center"},"TWINT payment will be processed via Stripe."),t("div",{class:"flex justify-center my-4"},[t("div",{class:"h-12 flex items-center justify-center bg-blue-500 text-white font-bold rounded px-4 py-2"}," TWINT ")])],-1)),t("button",{onClick:B,disabled:i.value,class:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(i.value?"Processing...":"Pay with TWINT"),9,R)])):x("",!0),a.value==="invoice"?(b(),y("div",G,[e[15]||(e[15]=t("div",{class:"bg-gray-50 p-4 rounded-lg mb-4"},[t("p",{class:"text-center"},"An invoice will be sent to your email address."),t("p",{class:"text-center text-sm text-gray-500 mt-2"},"Please provide your billing information below:")],-1)),t("form",{onSubmit:P(U,["prevent"])},[t("div",H,[e[12]||(e[12]=t("label",{for:"billing-name",class:"block text-sm font-medium text-gray-700 mb-1"},"Full Name",-1)),k(t("input",{type:"text",id:"billing-name","onUpdate:modelValue":e[3]||(e[3]=n=>d.value.name=n),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[I,d.value.name]])]),t("div",J,[e[13]||(e[13]=t("label",{for:"billing-address",class:"block text-sm font-medium text-gray-700 mb-1"},"Address",-1)),k(t("input",{type:"text",id:"billing-address","onUpdate:modelValue":e[4]||(e[4]=n=>d.value.address=n),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[I,d.value.address]])]),t("div",Q,[e[14]||(e[14]=t("label",{for:"billing-email",class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),k(t("input",{type:"email",id:"billing-email","onUpdate:modelValue":e[5]||(e[5]=n=>d.value.email=n),required:"",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[I,d.value.email]])]),t("button",{type:"submit",disabled:i.value,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},m(i.value?"Processing...":"Request Invoice"),9,X)],32)])):x("",!0),t("div",{class:"flex justify-center mt-6"},[t("button",{onClick:W,class:"border border-red-500 text-red-600 px-6 py-2 rounded-lg flex items-center hover:bg-red-50 transition"},e[16]||(e[16]=[t("span",{class:"mr-2"},"‚Üê",-1),v(" Back ")]))])])]))}},te=z(Y,[["__scopeId","data-v-8bc407a2"]]);export{te as default};
