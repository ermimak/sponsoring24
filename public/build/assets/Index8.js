import{D as y}from"./DashboardLayout.js";import{C as g,D as b,f,o as r,w as m,g as s,l as i,t,y as u,n as _,j as h,V as v,s as w}from"./vendor.js";import{_ as x}from"./_plugin-vue_export-helper.js";import"./SidebarLink.js";import"./NotificationDropdown.js";import"./app.js";/* empty css    */const k=g({components:{DashboardLayout:y},props:{user:Object,stripePublishableKey:String,licenseData:Object},data(){var e;return{standardPrice:500,discountAmount:50,stripe:null,paymentProcessing:!1,paymentError:null,linkCopied:!1,licenseExpiryDate:((e=this.licenseData)==null?void 0:e.expires_at)||null,daysUntilExpiry:this.calculateDaysUntilExpiry()}},computed:{discountedPrice(){return this.standardPrice-this.discountAmount},referralLink(){return`${window.location.origin}/register?ref=${this.user.referral_code}`}},methods:{calculateDaysUntilExpiry(){var l;if(!((l=this.licenseData)!=null&&l.expires_at))return null;const c=new Date(this.licenseData.expires_at)-new Date;return Math.ceil(c/(1e3*60*60*24))},async processPayment(){var e,o,c,l;if(!this.paymentProcessing){this.paymentProcessing=!0,this.paymentError=null;try{console.log("Creating checkout session for license...");const n=this.stripePublishableKey||((o=(e=this.page)==null?void 0:e.props)==null?void 0:o.stripeKey)||"pk_test_51RbbtsAc8DSpEFrZEjKJzXR7xRrhCOHEmS5HYVa9MIzeh6jpx6F36LvGkBDbhtjZjZHNpdPjCEbIubHY3bXYJ8Q7006xSd2JEW";console.log("Using Stripe key for license:",n),this.stripe=await v(n);const d=await axios.post(w("license.create-payment-intent"),{apply_discount:this.user.discount_eligible&&!this.user.discount_used});if(console.log("Response received:",d.data),d.data.dev_mode===!0&&d.data.success===!0){console.log("Development mode license created directly"),window.location.href=d.data.redirect;return}const{sessionId:p}=d.data;if(!p)throw new Error("No session ID returned from the server");console.log("Redirecting to Stripe Checkout...");const a=await this.stripe.redirectToCheckout({sessionId:p});if(a.error)throw console.error("Checkout redirect error:",a.error),a.error}catch(n){console.error("Payment processing error:",n),this.paymentError=((l=(c=n.response)==null?void 0:c.data)==null?void 0:l.error)||n.message||"An error occurred while processing your payment.",this.paymentProcessing=!1}}},copyReferralLink(){navigator.clipboard.writeText(this.referralLink).then(()=>{this.linkCopied=!0,setTimeout(()=>{this.linkCopied=!1},3e3)})}}}),C={class:"font-semibold text-xl text-gray-800 leading-tight"},D={class:"py-12"},$={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},P={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},E={class:"p-6 bg-white border-b border-gray-200"},L={key:0,class:"mb-8"},H={class:"text-lg font-medium text-gray-900 mb-4"},j={class:"bg-gray-50 p-6 rounded-lg mb-6"},S={class:"flex justify-between items-center mb-4"},z={class:"font-medium text-gray-800"},A={class:"text-gray-600 text-sm"},R={class:"text-right"},F={key:0,class:"text-green-600 font-bold"},M={class:"text-sm font-normal"},V={key:0,class:"bg-green-50 border border-green-200 p-3 rounded-md mb-4"},B={class:"text-green-700 text-sm"},U={key:1,class:"flex justify-center my-4"},Y={key:2},I={key:0,class:"bg-red-50 border border-red-200 p-3 rounded-md mb-4"},K={class:"text-red-700 text-sm"},N={class:"flex justify-end"},T=["disabled"],J={key:1,class:"mb-8"},O={class:"text-lg font-medium text-gray-900 mb-4"},Z={class:"bg-gray-50 p-6 rounded-lg"},W={class:"flex justify-between items-center mb-4"},X={class:"font-medium text-gray-800"},G={class:"text-gray-600 text-sm"},Q={class:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium"},q={class:"mt-4"},ee={class:"text-gray-700"},se={class:"font-mono bg-gray-100 px-2 py-1 rounded"},te={key:0,class:"mt-6"},oe={class:"bg-yellow-50 border border-yellow-200 p-3 rounded-md"},re={class:"text-yellow-700 text-sm"},ie={class:"mb-8"},ne={class:"text-lg font-medium text-gray-900 mb-4"},ae={class:"bg-gray-50 p-6 rounded-lg"},le={class:"text-gray-700 mb-4"},de={class:"flex items-center mt-4"},ce=["value"],ue={key:0,class:"text-green-600 text-sm mt-2"};function pe(e,o,c,l,n,d){const p=b("DashboardLayout");return r(),f(p,null,{header:m(()=>[s("h2",C,t(e.$t("License Management")),1)]),default:m(()=>[s("div",D,[s("div",$,[s("div",P,[s("div",E,[e.user.has_active_license?(r(),i("div",J,[s("h3",O,t(e.$t("Your License")),1),s("div",Z,[s("div",W,[s("div",null,[s("h4",X,t(e.$t("Sponsoring24 Annual License")),1),s("p",G,t(e.$t("Valid until"))+": "+t(e.licenseExpiryDate),1)]),s("div",Q,t(e.$t("Active")),1)]),s("div",q,[s("p",ee,[h(t(e.$t("License Key"))+": ",1),s("span",se,t(e.user.license_key||"N/A"),1)])]),e.daysUntilExpiry<=30?(r(),i("div",te,[s("div",oe,[s("p",re,[o[4]||(o[4]=s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline-block mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),h(" "+t(e.$t("Your license will expire in {days} days. Consider renewing soon.",{days:e.daysUntilExpiry})),1)])])])):u("",!0)])])):(r(),i("div",L,[s("h3",H,t(e.$t("Purchase Annual License")),1),s("div",j,[s("div",S,[s("div",null,[s("h4",z,t(e.$t("Sponsoring24 Annual License")),1),s("p",A,t(e.$t("Access to all premium features for one year")),1)]),s("div",R,[s("p",{class:_(["text-lg font-bold",{"line-through":e.user.discount_eligible&&!e.user.discount_used}])}," CHF "+t(e.standardPrice.toFixed(2)),3),e.user.discount_eligible&&!e.user.discount_used?(r(),i("p",F,[h(" CHF "+t(e.discountedPrice.toFixed(2))+" ",1),s("span",M,"("+t(e.$t("Referral discount applied"))+")",1)])):u("",!0)])]),e.user.discount_eligible&&!e.user.discount_used?(r(),i("div",V,[s("p",B,[o[2]||(o[2]=s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline-block mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z","clip-rule":"evenodd"}),s("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v8a1 1 0 11-2 0V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1)),h(" "+t(e.$t("You are eligible for a CHF 50 discount on your first annual license!")),1)])])):u("",!0),e.paymentProcessing?(r(),i("div",U,o[3]||(o[3]=[s("div",{class:"spinner"},null,-1)]))):(r(),i("div",Y,[e.paymentError?(r(),i("div",I,[s("p",K,t(e.paymentError),1)])):u("",!0),s("div",N,[s("button",{onClick:o[0]||(o[0]=(...a)=>e.processPayment&&e.processPayment(...a)),disabled:e.paymentProcessing,class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:border-blue-800 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150"},t(e.$t("Purchase License")),9,T)])]))])])),s("div",ie,[s("h3",ne,t(e.$t("Share Your Referral Link")),1),s("div",ae,[s("p",le,t(e.$t("Share your referral link with others. When someone signs up using your link and purchases a license, you will receive CHF 100 in bonus credits, and they will get CHF 50 off their first annual license.")),1),s("div",de,[s("input",{type:"text",readonly:"",value:e.referralLink,class:"flex-grow px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,8,ce),s("button",{onClick:o[1]||(o[1]=(...a)=>e.copyReferralLink&&e.copyReferralLink(...a)),class:"px-4 py-2 bg-gray-200 border border-gray-300 rounded-r-md hover:bg-gray-300 focus:outline-none"},o[5]||(o[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),s("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})],-1)]))]),e.linkCopied?(r(),i("p",ue,t(e.$t("Link copied to clipboard!")),1)):u("",!0)])])])])])])]),_:1})}const ve=x(k,[["render",pe],["__scopeId","data-v-ff9dd587"]]);export{ve as default};
