import{g as I,J as v,I as D,N as V,l as a,o as n,f as o,y as l,t as p,n as b,F as E,m as O,k as L,i as B,w as R,j as J,u as w,S as P,W as k}from"./vendor.js";import{r as m}from"./app.js";const T={class:"relative"},z={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"},F={key:0,class:"absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg overflow-hidden z-50"},H={class:"py-2 border-b border-gray-100"},U={class:"px-4 flex justify-between items-center"},W={class:"max-h-72 overflow-y-auto"},Y={key:0,class:"py-4 px-4 text-center text-sm text-gray-500"},q={class:"flex justify-between items-start"},G={class:"flex-1"},K={class:"text-sm text-gray-800 font-medium"},Q={class:"text-xs text-gray-500 mt-1"},X={class:"text-xs text-gray-400 mt-1"},Z=["onClick"],tt={class:"py-2 px-4 border-t border-gray-100 text-center"},st={__name:"NotificationDropdown",props:{notifications:{type:Array,default:()=>[]}},setup(N){const s=N,i=I(!1),d=v(()=>Array.isArray(s.notifications)?s.notifications:s.notifications&&s.notifications.data&&Array.isArray(s.notifications.data)?s.notifications.data:[]),A=v(()=>d.value.length>0),c=v(()=>d.value.filter(e=>!e.read_at).length),x=e=>{i.value&&!e.target.closest(".relative")&&(i.value=!1)};D(()=>{document.addEventListener("click",x),console.log("Notifications prop:",s.notifications),console.log("Notifications type:",typeof s.notifications),console.log("Is Array?",Array.isArray(s.notifications)),console.log("Length:",s.notifications?s.notifications.length:"N/A")}),V(()=>{document.removeEventListener("click",x)});const M=e=>{const t=new Date(e),y=Math.floor((new Date-t)/1e3);if(y<60)return"just now";const u=Math.floor(y/60);if(u<60)return`${u} ${u===1?"minute":"minutes"} ago`;const f=Math.floor(u/60);if(f<24)return`${f} ${f===1?"hour":"hours"} ago`;const h=Math.floor(f/24);if(h<30)return`${h} ${h===1?"day":"days"} ago`;const g=Math.floor(h/30);if(g<12)return`${g} ${g===1?"month":"months"} ago`;const _=Math.floor(g/12);return`${_} ${_===1?"year":"years"} ago`},S=e=>{try{if(!e)return"Notification";let t;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch{t={}}else t=e.data||{};if(!t||!t.type)return t&&t.message?t.message:"Notification";switch(t.type){case"account_approval":return"Account Approved";case"account_pending":return"Account Pending";case"account_rejection":return"Account Rejected";case"payment_received":return"Payment Received";case"project_update":return"Project Update";case"new_donation":return"New Donation";default:return t.message||"Notification"}}catch(t){return console.error("Error in getNotificationTitle:",t),"Notification"}},$=e=>{try{if(!e)return"";let t;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch{t={}}else t=e.data||{};return t.message||""}catch(t){return console.error("Error in getNotificationMessage:",t),""}},C=e=>{k.post(m("dashboard.notifications.mark-as-read",{notification:e.id}),{},{preserveScroll:!0,onSuccess:()=>{e.read_at=new Date().toISOString()}})},j=()=>{k.post(m("dashboard.notifications.mark-all-as-read"),{},{preserveScroll:!0,onSuccess:()=>{d.value.forEach(e=>{e.read_at||(e.read_at=new Date().toISOString())})}})};return(e,t)=>(n(),a("div",T,[o("button",{onClick:t[0]||(t[0]=r=>i.value=!i.value),class:b(["flex items-center relative p-2 rounded-full hover:bg-gray-100 transition-colors duration-200",{"bg-gray-100":c.value>0}])},[t[1]||(t[1]=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),c.value>0?(n(),a("span",z,p(c.value>9?"9+":c.value),1)):l("",!0)],2),i.value?(n(),a("div",F,[o("div",H,[o("div",U,[t[2]||(t[2]=o("h3",{class:"text-sm font-semibold text-gray-700"},"Notifications",-1)),c.value>0?(n(),a("button",{key:0,onClick:j,class:"text-xs text-blue-600 hover:text-blue-800"}," Mark all as read ")):l("",!0)])]),o("div",W,[A.value?l("",!0):(n(),a("div",Y," No notifications ")),(n(!0),a(E,null,O(d.value,r=>(n(),a("div",{key:r.id,class:b(["px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors duration-200",{"bg-blue-50":!r.read_at}])},[o("div",q,[o("div",G,[o("p",K,p(S(r)),1),o("p",Q,p($(r)),1),o("p",X,p(M(r.created_at)),1)]),r.read_at?l("",!0):(n(),a("button",{key:0,onClick:L(y=>C(r),["stop"]),class:"ml-2 text-xs text-blue-600 hover:text-blue-800"}," Mark as read ",8,Z))])],2))),128))]),o("div",tt,[B(w(P),{href:w(m)("dashboard.notifications.index"),class:"text-xs text-blue-600 hover:text-blue-800"},{default:R(()=>t[3]||(t[3]=[J(" View all notifications ")])),_:1},8,["href"])])])):l("",!0)]))}};export{st as _};
