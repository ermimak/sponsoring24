import{p as L,r as y,s as T,d as x,o as E,a as o,e as R,t as w,k as S,h,b as B,W as V}from"./app-BDDThPdq.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */var C="basil",z=function(e){return e===3?"v3":e},P="https://js.stripe.com",J="".concat(P,"/").concat(C,"/stripe.js"),N=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,O=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var W=function(e){return N.test(e)||O.test(e)},A=function(){for(var e=document.querySelectorAll('script[src^="'.concat(P,'"]')),t=0;t<e.length;t++){var i=e[t];if(W(i.src))return i}return null},j=function(e){var t="",i=document.createElement("script");i.src="".concat(J).concat(t);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(i),i},U=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.3.0",startTime:t})},u=null,g=null,b=null,D=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},F=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},G=function(e){return u!==null?u:(u=new Promise(function(t,i){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var n=A();if(!(n&&e)){if(!n)n=j(e);else if(n&&b!==null&&g!==null){var s;n.removeEventListener("load",b),n.removeEventListener("error",g),(s=n.parentNode)===null||s===void 0||s.removeChild(n),n=j(e)}}b=F(t,i),g=D(i),n.addEventListener("load",b),n.addEventListener("error",g)}catch(c){i(c);return}}),u.catch(function(t){return u=null,Promise.reject(t)}))},M=function(e,t,i){if(e===null)return null;var n=t[0],s=n.match(/^pk_test/),c=z(e.version),m=C;s&&c!==m&&console.warn("Stripe.js@".concat(c," was loaded on the page, but @stripe/stripe-js@").concat("7.3.0"," expected Stripe.js@").concat(m,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var v=e.apply(void 0,t);return U(v,i),v},p,k=!1,I=function(){return p||(p=G(null).catch(function(e){return p=null,Promise.reject(e)}),p)};Promise.resolve().then(function(){return I()}).catch(function(a){k||console.warn(a)});var $=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];k=!0;var n=Date.now();return I().then(function(s){return M(s,t,n)})};const X={class:"min-h-screen bg-gray-50 flex flex-col items-center justify-center"},H={class:"bg-white shadow-lg rounded-lg p-8 w-full max-w-md mt-10"},q={class:"text-3xl font-bold text-center mb-6"},K={class:"space-y-4 mb-8"},Y={key:0,class:"mt-6"},Z=["disabled"],Q={__name:"DonationPayment",props:{project:Object,participant:Object,donation:Object},setup(a){const e=a;L();const t=y(null),i=y(!1),n=y(null),s=y(null);T(async()=>{try{const l="pk_test_51RbbtsAc8DSpEFrZEjKJzXR7xRrhCOHEmS5HYVa9MIzeh6jpx6F36LvGkBDbhtjZjZHNpdPjCEbIubHY3bXYJ8Q7006xSd2JEW";if(n.value=await $(l),!n.value)throw new Error("Failed to initialize Stripe");const r=n.value.elements();s.value=r.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),s.value.mount("#card-element"),s.value.on("change",d=>{const f=document.getElementById("card-errors");d.error?f.textContent=d.error.message:f.textContent=""})}catch(l){console.error("Error initializing Stripe:",l);const r=document.getElementById("card-errors");r&&(r.textContent="Failed to initialize payment system. Please try again later.")}});function c(l){t.value=l}async function m(){if(!n.value||!s.value){console.error("Stripe not initialized");return}i.value=!0;try{const l=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e.donation.amount,currency:e.donation.currency.toLowerCase(),donation_id:e.donation.id})}),{clientSecret:r}=await l.json(),d=await n.value.confirmCardPayment(r,{payment_method:{card:s.value,billing_details:{email:e.donation.supporter_email}}});if(d.error){const f=document.getElementById("card-errors");f.textContent=d.error.message}else d.paymentIntent.status==="succeeded"&&V.visit(route("participant.donate.success",{projectId:e.project.id,participantId:e.participant.id,donationId:e.donation.id}))}catch(l){console.error("Payment failed:",l);const r=document.getElementById("card-errors");r.textContent="An error occurred while processing your payment. Please try again."}finally{i.value=!1}}function v(){window.history.back()}return(l,r)=>(E(),x("div",X,[o("div",H,[o("h1",q," Pay "+w(a.donation.amount)+" "+w(a.donation.currency)+" now via ",1),o("div",K,[o("button",{onClick:r[0]||(r[0]=d=>c("invoice")),class:S([{"bg-purple-50 border-purple-500":t.value==="invoice"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[3]||(r[3]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2","stroke-width":"2"})])],-1),h(" The invoice ")]),2),o("button",{onClick:r[1]||(r[1]=d=>c("twint")),class:S([{"bg-purple-50 border-purple-500":t.value==="twint"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[4]||(r[4]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"})])],-1),h(" TWINT ")]),2),o("button",{onClick:r[2]||(r[2]=d=>c("card")),class:S([{"bg-purple-50 border-purple-500":t.value==="card"},"w-full flex items-center px-4 py-3 border rounded-lg hover:bg-gray-100 transition"])},r[5]||(r[5]=[o("span",{class:"mr-3"},[o("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor"},[o("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2","stroke-width":"2"}),o("rect",{x:"6",y:"10",width:"4",height:"4","stroke-width":"2"})])],-1),h(" Credit or debit card ")]),2)]),t.value==="card"?(E(),x("div",Y,[o("form",{id:"payment-form",onSubmit:B(m,["prevent"])},[r[6]||(r[6]=o("div",{id:"card-element",class:"p-3 border rounded-lg mb-4"},null,-1)),r[7]||(r[7]=o("div",{id:"card-errors",class:"text-red-500 text-sm mb-4",role:"alert"},null,-1)),o("button",{type:"submit",disabled:i.value,class:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"},w(i.value?"Processing...":`Pay ${a.donation.amount} ${a.donation.currency}`),9,Z)],32)])):R("",!0),o("div",{class:"flex justify-center mt-6"},[o("button",{onClick:v,class:"border border-red-500 text-red-600 px-6 py-2 rounded-lg flex items-center hover:bg-red-50 transition"},r[8]||(r[8]=[o("span",{class:"mr-2"},"‚Üê",-1),h(" Back ")]))])])]))}},ne=_(Q,[["__scopeId","data-v-4688c73e"]]);export{ne as default};
