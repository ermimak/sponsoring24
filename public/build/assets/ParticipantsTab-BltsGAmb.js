import{p as O,r as m,B as J,s as K,z as Q,d as r,o as d,a as t,e as b,t as u,h as C,f,v as x,g as X,F as E,j as S,b as B,q as T,y,W as $,i as Y,w as Z,u as ee,S as te}from"./app-BDDThPdq.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const ae={class:"flex justify-between items-center mb-4"},le={class:"text-xl font-semibold"},oe={class:"flex flex-col md:flex-row gap-4 mb-4"},ie={class:"bg-gray-50 border rounded p-4 w-full md:w-1/3"},ne={class:"flex items-center"},re={class:"flex-1 overflow-x-auto"},de={class:"min-w-full divide-y divide-gray-200 bg-white rounded-lg border"},ue={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4 whitespace-nowrap"},ce={class:"text-sm text-gray-500"},me={key:0,class:"text-green-600 text-xs"},ve={class:"px-6 py-4 whitespace-nowrap"},be={class:"px-6 py-4 whitespace-nowrap"},fe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"px-6 py-4 whitespace-nowrap flex space-x-2"},xe=["onClick"],ye=["onClick"],he=["onClick"],we={key:0},ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},je={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg"},_e={class:"mb-4"},Ce=["value"],Me={class:"mb-4"},Ee={class:"mb-4"},Se={class:"flex gap-2 justify-end"},$e=["disabled"],Pe={key:0,class:"text-gray-500 mt-2"},Ie={key:1,class:"text-red-600 mt-2"},Ve={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Fe={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg"},Be={class:"text-xl font-bold mb-4"},Te={class:"mb-4"},Ue=["value"],ze={class:"mb-4"},Ne={class:"mb-4"},Le={class:"flex gap-2 justify-end"},qe=["disabled"],Ae={key:0,class:"text-gray-500 mt-2"},De={key:1,class:"text-red-600 mt-2"},He={__name:"ParticipantsTab",props:{projectId:String},setup(U){O();const c=U,h=m([]),w=m(""),M=m(!1),v=m([]),k=m(!1),j=m(!1),_=m(null),n=m({template_id:"",subject:"",body:""}),i=m({template_id:"",subject:"",body:""}),p=m(!1),o=m("");async function P(){var l,e;p.value=!0,o.value="";try{console.log("Fetching participants for project:",c.projectId);const{data:s}=await y.get(`/dashboard/projects/${c.projectId}/participants`);h.value=s.data||[],console.log("Participants fetched:",h.value)}catch(s){console.error("Fetch error:",s.response?s.response.data:s),o.value="Failed to load participants: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message)}finally{p.value=!1}}async function I(){var l,e;try{const{data:s}=await y.get("/dashboard/email-templates",{params:{project_id:c.projectId}});v.value=s.data}catch(s){o.value="Failed to load email templates: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message)}}function z(){console.log("Navigating to:",`/dashboard/projects/${c.projectId}/participants/create`),c.projectId?$.visit(`/dashboard/projects/${c.projectId}/participants/create`,{onError:l=>{console.error("Navigation failed:",l),alert("Failed to navigate to add page. Check console for details.")},onSuccess:()=>{console.log("Navigation successful")}}):(console.error("projectId is undefined"),alert("Project ID is missing. Please reload the page."))}function N(l){$.visit(`/projects/${c.projectId}/participants/${l.id}`)}function L(l){$.visit(`/projects/${c.projectId}/participants/${l.id}/donate`)}function q(l){_.value=l;const e=v.value.find(s=>s.type==="participant");n.value={template_id:(e==null?void 0:e.id)||"",subject:(e==null?void 0:e.subject)||"",body:(e==null?void 0:e.body)||""},k.value=!0}async function A(){var l,e;i.value={template_id:"",subject:"",body:""},p.value=!0,o.value="";try{if(await I(),v.value.length===0){o.value="No email templates found for this project. Please create at least one template.";return}const s=v.value.find(g=>g.type==="mass_participant")||v.value[0];s&&(i.value={template_id:s.id||"",subject:s.subject||"",body:s.body||""}),j.value=!0}catch(s){o.value="Failed to load email templates: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message),console.error("Error loading templates:",s)}finally{p.value=!1}}function D(){if(n.value.template_id)try{const l=v.value.find(e=>e.id===n.value.template_id);l&&(n.value.subject=l.subject||"",n.value.body=l.body||"")}catch(l){console.error("Error loading template:",l)}}function H(){if(i.value.template_id)try{const l=v.value.find(e=>e.id===i.value.template_id);l&&(i.value.subject=l.subject||"",i.value.body=l.body||"")}catch(l){console.error("Error loading template:",l)}}async function R(){var l,e;if(!n.value.template_id){o.value="Please select an email template.";return}p.value=!0,o.value="";try{const s=await y.post(route("dashboard.participants.sendEmail",_.value.id),{template_id:n.value.template_id,subject:n.value.subject,body:n.value.body,project_id:c.projectId});k.value=!1,alert("Email sent successfully!")}catch(s){o.value="Failed to send email: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message),console.error("Error sending email:",s)}finally{p.value=!1}}async function W(){var l,e;if(!i.value.template_id){o.value="Please select an email template.";return}p.value=!0,o.value="";try{const s=await y.post(route("project.participants.massEmail",c.projectId),{template_id:i.value.template_id,subject:i.value.subject,body:i.value.body});j.value=!1,s.data.results?alert(`Mass email sent successfully! ${s.data.results.success} sent, ${s.data.results.failed} failed, ${s.data.results.skipped} skipped.`):alert("Mass email sent successfully!")}catch(s){o.value="Failed to send mass email: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message),console.error("Error sending mass email:",s)}finally{p.value=!1}}async function G(){var l,e;p.value=!0,o.value="";try{const{data:s}=await y.get(`/dashboard/projects/${c.projectId}/participants/export`,{responseType:"blob"}),g=window.URL.createObjectURL(new Blob([s])),a=document.createElement("a");a.href=g,a.setAttribute("download",`participants_${c.projectId}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){o.value="Failed to export participants: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message)}finally{p.value=!1}}const V=J(()=>{let l=h.value;if(w.value){const e=w.value.toLowerCase();l=l.filter(s=>`${s.first_name} ${s.last_name}`.toLowerCase().includes(e)||s.email.toLowerCase().includes(e))}return M.value||(l=l.filter(e=>e.member_groups.length>0)),l});return K(()=>{P(),I()}),Q(()=>c.projectId,()=>{P()}),(l,e)=>{var s,g;return d(),r("div",null,[t("div",ae,[t("h2",le,"Participants "+u(h.value.length)+" entries",1),t("div",{class:"flex space-x-2"},[t("button",{onClick:A,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded flex items-center",title:"Mass Email"},e[10]||(e[10]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9-6 9 6v12a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9 6 9-6"})],-1),C(" Mass email ")])),t("button",{onClick:G,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded flex items-center",title:"Export"},e[11]||(e[11]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),C(" Export ")])),t("button",{onClick:z,class:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"}," Add ")])]),e[29]||(e[29]=t("p",{class:"text-gray-600 mb-4"}," Members must be participants in a project to be able to collect donations. They can be added to the project individually or in groups. ",-1)),t("div",oe,[t("div",ie,[e[13]||(e[13]=t("h3",{class:"font-semibold mb-2"},"Filter",-1)),e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"Search",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),type:"text",class:"input w-full mb-2",placeholder:"Search"},null,512),[[x,w.value]]),t("label",ne,[f(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),class:"mr-2"},null,512),[[X,M.value]]),e[12]||(e[12]=C(" All groups "))])]),t("div",re,[t("table",de,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Participant"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Supporters"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sales volume"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Emails"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",ue,[(d(!0),r(E,null,S(V.value,a=>(d(),r("tr",{key:a.id},[t("td",pe,[Y(ee(te),{href:`/dashboard/members/${a.id}/edit`,class:"text-indigo-600 hover:text-indigo-900"},{default:Z(()=>[C(u(a.first_name)+" "+u(a.last_name),1)]),_:2},1032,["href"]),t("p",ce,u(a.email),1),a.landing_page_opened?(d(),r("span",me,"Landing page opened")):b("",!0)]),t("td",ve,u(a.supporters),1),t("td",be,u(a.sales_volume),1),t("td",fe,u(a.emails),1),t("td",ge,[t("button",{onClick:F=>N(a),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"To the participant landing page"},e[15]||(e[15]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,xe),t("button",{onClick:F=>L(a),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"Public Donation Page"},e[16]||(e[16]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 1.343-3 3v2h6v-2c0-1.657-1.343-3-3-3zm0-4a7 7 0 00-7 7v2h2v-2a5 5 0 0110 0v2h2v-2a7 7 0 00-7-7z"})],-1)]),8,ye),t("button",{onClick:F=>q(a),class:"text-purple-600 hover:text-purple-800 flex items-center",title:"Send Email"},e[17]||(e[17]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9-6 9 6v12a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l9 6 9-6"})],-1)]),8,he)])]))),128)),V.value.length===0?(d(),r("tr",we,e[18]||(e[18]=[t("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-400"},"No entries found 🥺",-1)]))):b("",!0)])])])]),j.value?(d(),r("div",ke,[t("div",je,[e[24]||(e[24]=t("h2",{class:"text-xl font-bold mb-4"},"Send Mass Email",-1)),t("form",{onSubmit:B(W,["prevent"])},[t("div",_e,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium mb-1"},"Select Email Template",-1)),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.template_id=a),onChange:H,class:"input w-full",required:""},[e[20]||(e[20]=t("option",{value:"",disabled:""},"Select a template",-1)),(d(!0),r(E,null,S(v.value,a=>(d(),r("option",{key:a.id,value:a.id},u(a.name)+" ("+u(a.type)+") ",9,Ce))),128))],544),[[T,i.value.template_id]])]),t("div",Me,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-1"},"Subject",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.subject=a),type:"text",class:"input w-full",required:""},null,512),[[x,i.value.subject]])]),t("div",Ee,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),f(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.body=a),class:"input w-full",rows:"5",required:""},null,512),[[x,i.value.body]])]),t("div",Se,[t("button",{type:"button",onClick:e[5]||(e[5]=a=>j.value=!1),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",class:"bg-purple-600 text-white px-4 py-2 rounded",disabled:p.value},"Send",8,$e)])],32),p.value?(d(),r("div",Pe,"Sending...")):b("",!0),o.value?(d(),r("div",Ie,u(o.value),1)):b("",!0)])])):b("",!0),k.value?(d(),r("div",Ve,[t("div",Fe,[t("h2",Be,"Send Email to "+u((s=_.value)==null?void 0:s.first_name)+" "+u((g=_.value)==null?void 0:g.last_name),1),t("form",{onSubmit:B(R,["prevent"])},[t("div",Te,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-1"},"Select Email Template",-1)),f(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.template_id=a),onChange:D,class:"input w-full",required:""},[e[25]||(e[25]=t("option",{value:"",disabled:""},"Select a template",-1)),(d(!0),r(E,null,S(v.value,a=>(d(),r("option",{key:a.id,value:a.id},u(a.name)+" ("+u(a.type)+") ",9,Ue))),128))],544),[[T,n.value.template_id]])]),t("div",ze,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-1"},"Subject",-1)),f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.subject=a),type:"text",class:"input w-full",required:""},null,512),[[x,n.value.subject]])]),t("div",Ne,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),f(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.body=a),class:"input w-full",rows:"5",required:""},null,512),[[x,n.value.body]])]),t("div",Le,[t("button",{type:"button",onClick:e[9]||(e[9]=a=>k.value=!1),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded"},"Cancel"),t("button",{type:"submit",class:"bg-purple-600 text-white px-4 py-2 rounded",disabled:p.value},"Send",8,qe)])],32),p.value?(d(),r("div",Ae,"Sending...")):b("",!0),o.value?(d(),r("div",De,u(o.value),1)):b("",!0)])])):b("",!0)])}}},Oe=se(He,[["__scopeId","data-v-eea0a2ff"]]);export{Oe as default};
